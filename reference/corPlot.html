<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Correlation matrices with conditioning — corPlot • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Correlation matrices with conditioning — corPlot"><meta name="description" content="Function to to draw and visualise correlation matrices using lattice. The
primary purpose is as a tool for exploratory data analysis. Hierarchical
clustering is used to group similar variables."><meta property="og:description" content="Function to to draw and visualise correlation matrices using lattice. The
primary purpose is as a tool for exploratory data analysis. Hierarchical
clustering is used to group similar variables."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (external)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Correlation matrices with conditioning</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/master/R/corPlot.R" class="external-link"><code>R/corPlot.R</code></a></small>
      <div class="d-none name"><code>corPlot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to to draw and visualise correlation matrices using lattice. The
primary purpose is as a tool for exploratory data analysis. Hierarchical
clustering is used to group similar variables.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">corPlot</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  pollutants <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  use <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span>,</span>
<span>  dendrogram <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lower <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  r.thresh <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  text.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mydata">mydata<a class="anchor" aria-label="anchor" href="#arg-mydata"></a></dt>
<dd><p>A data frame which should consist of some numeric columns.</p></dd>


<dt id="arg-pollutants">pollutants<a class="anchor" aria-label="anchor" href="#arg-pollutants"></a></dt>
<dd><p>the names of data-series in <code>mydata</code> to be plotted by
<code>corPlot</code>. The default option <code>NULL</code> and the alternative
“all” use all available valid (numeric) data.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. “season”, “year”, “weekday” and so
on. For example, <code>type = "season"</code> will produce four plots — one for
each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.</p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>Should the data be ordered according to cluster analysis. If
<code>TRUE</code> hierarchical clustering is applied to the correlation matrices
using <code>hclust</code> to group similar variables together. With many
variables clustering can greatly assist interpretation.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>The correlation method to use. Can be “pearson”,
“spearman” or “kendall”.</p></dd>


<dt id="arg-use">use<a class="anchor" aria-label="anchor" href="#arg-use"></a></dt>
<dd><p>How to handle missing values in the <code>cor</code> function. The default is
"pairwise.complete.obs". Care should be taken with the choice of how to
handle missing data when considering pair-wise correlations.</p></dd>


<dt id="arg-dendrogram">dendrogram<a class="anchor" aria-label="anchor" href="#arg-dendrogram"></a></dt>
<dd><p>Should a dendrogram be plotted? When <code>TRUE</code> a
dendrogram is shown on the right of the plot. Note that this will only work
for <code>type = "default"</code>.</p></dd>


<dt id="arg-lower">lower<a class="anchor" aria-label="anchor" href="#arg-lower"></a></dt>
<dd><p>Should only the lower triangle be plotted?</p></dd>


<dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>Colours to be used for plotting. Options include
“default”, “increment”, “heat”, “spectral”,
“hue”, “greyscale” and user defined (see <code>openColours</code>
for more details).</p></dd>


<dt id="arg-r-thresh">r.thresh<a class="anchor" aria-label="anchor" href="#arg-r-thresh"></a></dt>
<dd><p>Values of greater than <code>r.thresh</code> will be shown in bold
type. This helps to highlight high correlations.</p></dd>


<dt id="arg-text-col">text.col<a class="anchor" aria-label="anchor" href="#arg-text-col"></a></dt>
<dd><p>The colour of the text used to show the correlation values.
The first value controls the colour of negative correlations and the second
positive.</p></dd>


<dt id="arg-auto-text">auto.text<a class="anchor" aria-label="anchor" href="#arg-auto-text"></a></dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the `2' in NO2.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract corPlot components and plotting them in other
ways.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other graphical parameters passed onto <code>lattice:levelplot</code>,
with common axis and title labelling options (such as <code>xlab</code>,
<code>ylab</code>, <code>main</code>) being passed via <code>quickText</code> to handle
routine formatting.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an <a href="openair-package.html">openair</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>corPlot</code> function plots correlation matrices. The implementation
relies heavily on that shown in Sarkar (2007), with a few extensions.</p>
<p>Correlation matrices are a very effective way of understating relationships
between many variables. The <code>corPlot</code> shows the correlation coded in
three ways: by shape (ellipses), colour and the numeric value. The ellipses
can be thought of as visual representations of scatter plot. With a perfect
positive correlation a line at 45 degrees positive slope is drawn. For zero
correlation the shape becomes a circle. See examples below.</p>
<p>With many different variables it can be difficult to see relationships
between variables, i.e., which variables tend to behave most like one
another. For this reason hierarchical clustering is applied to the
correlation matrices to group variables that are most similar to one another
(if <code>cluster = TRUE</code>).</p>
<p>If clustering is chosen it is also possible to add a dendrogram using the
option <code>dendrogram = TRUE</code>. Note that dendrogramscan only be plotted for
<code>type = "default"</code> i.e. when there is only a single panel. The
dendrogram can also be recovered from the plot object itself and plotted more
clearly; see examples below.</p>
<p>It is also possible to use the <code>openair</code> type option to condition the
data in many flexible ways, although this may become difficult to visualise
with too many panels.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Sarkar, D. (2007). Lattice Multivariate Data Visualization with
R. New York: Springer.</p>
<p>Friendly, M. (2002). Corrgrams : Exploratory displays for correlation
matrices. American Statistician, 2002(4), 1-16. doi:10.1198/000313002533</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>taylor.diagram</code> from the <code>plotrix</code> package from which
some of the annotation code was used.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw — but mostly based on code contained in Sarkar (2007)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## basic corrgram plot</span></span></span>
<span class="r-in"><span><span class="fu">corPlot</span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="corPlot-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## plot by season ... and so on</span></span></span>
<span class="r-in"><span><span class="fu">corPlot</span><span class="op">(</span><span class="va">mydata</span>, type <span class="op">=</span> <span class="st">"season"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="corPlot-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## recover dendrogram when cluster = TRUE and plot it</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span><span class="fu">corPlot</span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="corPlot-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">clust</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="corPlot-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## a more interesting are hydrocarbon measurements</span></span></span>
<span class="r-in"><span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="importUKAQ-wrapper.html">importAURN</a></span><span class="op">(</span>site <span class="op">=</span> <span class="st">"my1"</span>, year <span class="op">=</span> <span class="fl">2005</span>, hc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## now it is possible to see the hydrocarbons that behave most</span></span></span>
<span class="r-in"><span><span class="co">## similarly to one another</span></span></span>
<span class="r-in"><span><span class="fu">corPlot</span><span class="op">(</span><span class="va">hc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

