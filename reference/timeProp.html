<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Time series plot with categories shown as a stacked bar chart — timeProp • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Time series plot with categories shown as a stacked bar chart — timeProp"><meta name="description" content="This function shows time series plots as stacked bar charts. The different
categories in the bar chart are made up from a character or factor variable
in a data frame. The function is primarily developed to support the plotting
of cluster analysis output from polarCluster and
trajCluster that consider local and regional (back trajectory)
cluster analysis respectively. However, the function has more general use for
understanding time series data."><meta property="og:description" content="This function shows time series plots as stacked bar charts. The different
categories in the bar chart are made up from a character or factor variable
in a data frame. The function is primarily developed to support the plotting
of cluster analysis output from polarCluster and
trajCluster that consider local and regional (back trajectory)
cluster analysis respectively. However, the function has more general use for
understanding time series data."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (external)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Time series plot with categories shown as a stacked bar chart</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/master/R/timeProp.R" class="external-link"><code>R/timeProp.R</code></a></small>
      <div class="d-none name"><code>timeProp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function shows time series plots as stacked bar charts. The different
categories in the bar chart are made up from a character or factor variable
in a data frame. The function is primarily developed to support the plotting
of cluster analysis output from <code><a href="polarCluster.html">polarCluster</a></code> and
<code><a href="trajCluster.html">trajCluster</a></code> that consider local and regional (back trajectory)
cluster analysis respectively. However, the function has more general use for
understanding time series data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">timeProp</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  proportion <span class="op">=</span> <span class="st">"cluster"</span>,</span>
<span>  avg.time <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>  date.breaks <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  date.format <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  key.columns <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  key.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>  key.title <span class="op">=</span> <span class="va">proportion</span>,</span>
<span>  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mydata">mydata<a class="anchor" aria-label="anchor" href="#arg-mydata"></a></dt>
<dd><p>A data frame containing the fields <code>date</code>,
<code>pollutant</code> and a splitting variable <code>proportion</code></p></dd>


<dt id="arg-pollutant">pollutant<a class="anchor" aria-label="anchor" href="#arg-pollutant"></a></dt>
<dd><p>Name of the pollutant to plot contained in <code>mydata</code>.</p></dd>


<dt id="arg-proportion">proportion<a class="anchor" aria-label="anchor" href="#arg-proportion"></a></dt>
<dd><p>The splitting variable that makes up the bars in the bar
chart e.g. <code>proportion = "cluster"</code> if the output from
<code>polarCluster</code> is being analysed. If <code>proportion</code> is a numeric
variable it is split into 4 quantiles (by default) by <code>cutData</code>. If
<code>proportion</code> is a factor or character variable then the categories are
used directly.</p></dd>


<dt id="arg-avg-time">avg.time<a class="anchor" aria-label="anchor" href="#arg-avg-time"></a></dt>
<dd><p>This defines the time period to average to. Can be
“sec”, “min”, “hour”, “day”, “DSTday”,
“week”, “month”, “quarter” or “year”. For much
increased flexibility a number can precede these options followed by a
space. For example, a timeAverage of 2 months would be <code>period = "2
  month"</code>.</p>
<p>Note that <code>avg.time</code> when used in <code>timeProp</code> should be greater
than the time gap in the original data. For example, <code>avg.time =
  "day"</code> for hourly data is OK, but <code>avg.time = "hour"</code> for daily data
is not.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. "season", "year", "weekday" and so on. For example,
<code>type = "season"</code> will produce four plots — one for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.</p>
<p><code>type</code> must be of length one.</p></dd>


<dt id="arg-normalise">normalise<a class="anchor" aria-label="anchor" href="#arg-normalise"></a></dt>
<dd><p>If <code>normalise = TRUE</code> then each time interval is scaled
to 100. This is helpful to show the relative (percentage) contribution of
the proportions.</p></dd>


<dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>Colours to be used for plotting. Options include
“default”, “increment”, “heat”, “jet” and
<code>RColorBrewer</code> colours — see the <code>openair</code> <code>openColours</code>
function for more details. For user defined the user can supply a list of
colour names recognised by R (type <code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colours()</a></code> to see the full list).
An example would be <code>cols = c("yellow", "green", "blue")</code></p></dd>


<dt id="arg-date-breaks">date.breaks<a class="anchor" aria-label="anchor" href="#arg-date-breaks"></a></dt>
<dd><p>Number of major x-axis intervals to use. The function will
try and choose a sensible number of dates/times as well as formatting the
date/time appropriately to the range being considered.  This does not
always work as desired automatically. The user can therefore increase or
decrease the number of intervals by adjusting the value of
<code>date.breaks</code> up or down.</p></dd>


<dt id="arg-date-format">date.format<a class="anchor" aria-label="anchor" href="#arg-date-format"></a></dt>
<dd><p>This option controls the date format on the x-axis. While
<code>timePlot</code> generally sets the date format sensibly there can be some
situations where the user wishes to have more control. For format types see
<code>strptime</code>. For example, to format the date like “Jan-2012” set
<code>date.format = "%b-%Y"</code>.</p></dd>


<dt id="arg-key-columns">key.columns<a class="anchor" aria-label="anchor" href="#arg-key-columns"></a></dt>
<dd><p>Number of columns to be used in the key. With many
pollutants a single column can make to key too wide. The user can thus
choose to use several columns by setting <code>columns</code> to be less than the
number of pollutants.</p></dd>


<dt id="arg-key-position">key.position<a class="anchor" aria-label="anchor" href="#arg-key-position"></a></dt>
<dd><p>Location where the scale key is to plotted. Allowed
arguments currently include “top”, “right”, “bottom”
and “left”.</p></dd>


<dt id="arg-key-title">key.title<a class="anchor" aria-label="anchor" href="#arg-key-title"></a></dt>
<dd><p>The title of the key.</p></dd>


<dt id="arg-auto-text">auto.text<a class="anchor" aria-label="anchor" href="#arg-auto-text"></a></dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels etc. will automatically try and format pollutant
names and units properly e.g.  by subscripting the `2' in NO2.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other ways.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other graphical parameters passed onto <code>timeProp</code> and
<code>cutData</code>. For example, <code>timeProp</code> passes the option
<code>hemisphere = "southern"</code> on to <code>cutData</code> to provide southern
(rather than default northern) hemisphere handling of <code>type =
  "season"</code>. Similarly, common axis and title labelling options (such as
<code>xlab</code>, <code>ylab</code>, <code>main</code>) are passed to <code>xyplot</code> via
<code>quickText</code> to handle routine formatting.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an <a href="openair-package.html">openair</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In order to plot time series in this way, some sort of time aggregation is
needed, which is controlled by the option <code>avg.time</code>.</p>
<p>The plot shows the value of <code>pollutant</code> on the y-axis (averaged
according to <code>avg.time</code>). The time intervals are made up of bars split
according to <code>proportion</code>. The bars therefore show how the total value
of <code>pollutant</code> is made up for any time interval.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other time series and trend functions:
<code><a href="TheilSen.html">TheilSen</a>()</code>,
<code><a href="calendarPlot.html">calendarPlot</a>()</code>,
<code><a href="runRegression.html">runRegression</a>()</code>,
<code><a href="smoothTrend.html">smoothTrend</a>()</code>,
<code><a href="timePlot.html">timePlot</a>()</code>,
<code><a href="timeVariation.html">timeVariation</a>()</code>,
<code><a href="trendLevel.html">trendLevel</a>()</code></p>
<p>Other cluster analysis functions:
<code><a href="polarCluster.html">polarCluster</a>()</code>,
<code><a href="trajCluster.html">trajCluster</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## monthly plot of SO2 showing the contribution by wind sector</span></span></span>
<span class="r-in"><span><span class="fu">timeProp</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"so2"</span>, avg.time <span class="op">=</span> <span class="st">"month"</span>, proportion <span class="op">=</span> <span class="st">"wd"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>219 missing wind direction line(s) removed</span>
<span class="r-plt img"><img src="timeProp-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

