<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate clusters for back trajectories — trajCluster • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate clusters for back trajectories — trajCluster"><meta name="description" content="This function carries out cluster analysis of HYSPLIT back trajectories. The
function is specifically designed to work with the trajectories imported
using the openair importTraj function, which provides
pre-calculated back trajectories at specific receptor locations."><meta property="og:description" content="This function carries out cluster analysis of HYSPLIT back trajectories. The
function is specifically designed to work with the trajectories imported
using the openair importTraj function, which provides
pre-calculated back trajectories at specific receptor locations."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (external)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate clusters for back trajectories</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/master/R/trajCluster.R" class="external-link"><code>R/trajCluster.R</code></a></small>
      <div class="d-none name"><code>trajCluster.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function carries out cluster analysis of HYSPLIT back trajectories. The
function is specifically designed to work with the trajectories imported
using the <code>openair</code> <code>importTraj</code> function, which provides
pre-calculated back trajectories at specific receptor locations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trajCluster</span><span class="op">(</span></span>
<span>  <span class="va">traj</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Euclid"</span>,</span>
<span>  n.cluster <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"Set1"</span>,</span>
<span>  split.after <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  map.fill <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  map.cols <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>  map.alpha <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  projection <span class="op">=</span> <span class="st">"lambert"</span>,</span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">51</span>, <span class="fl">51</span><span class="op">)</span>,</span>
<span>  orientation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  by.type <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  origin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-traj">traj<a class="anchor" aria-label="anchor" href="#arg-traj"></a></dt>
<dd><p>An openair trajectory data frame resulting from the use of
<code>importTraj</code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Method used to calculate the distance matrix for the back
trajectories. There are two methods available: “Euclid” and
“Angle”.</p></dd>


<dt id="arg-n-cluster">n.cluster<a class="anchor" aria-label="anchor" href="#arg-n-cluster"></a></dt>
<dd><p>Number of clusters to calculate.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. “season”, “year”, “weekday” and so
on. For example, <code>type = "season"</code> will produce four plots — one for
each season. Note that the cluster calculations are separately made of each
level of "type".</p></dd>


<dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>Colours to be used for plotting. Options include
“default”, “increment”, “heat”, “jet” and
<code>RColorBrewer</code> colours — see the <code>openair</code> <code>openColours</code>
function for more details. For user defined the user can supply a list of
colour names recognised by R (type <code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colours()</a></code> to see the full list).
An example would be <code>cols = c("yellow", "green", "blue")</code></p></dd>


<dt id="arg-split-after">split.after<a class="anchor" aria-label="anchor" href="#arg-split-after"></a></dt>
<dd><p>For <code>type</code> other than “default” e.g.
“season”, the trajectories can either be calculated for each level
of <code>type</code> independently or extracted after the cluster calculations
have been applied to the whole data set.</p></dd>


<dt id="arg-map-fill">map.fill<a class="anchor" aria-label="anchor" href="#arg-map-fill"></a></dt>
<dd><p>Should the base map be a filled polygon? Default is to fill
countries.</p></dd>


<dt id="arg-map-cols">map.cols<a class="anchor" aria-label="anchor" href="#arg-map-cols"></a></dt>
<dd><p>If <code>map.fill = TRUE</code> <code>map.cols</code> controls the fill
colour. Examples include <code>map.fill = "grey40"</code> and <code>map.fill =
  openColours("default", 10)</code>. The latter colours the countries and can help
differentiate them.</p></dd>


<dt id="arg-map-alpha">map.alpha<a class="anchor" aria-label="anchor" href="#arg-map-alpha"></a></dt>
<dd><p>The transparency level of the filled map which takes values
from 0 (full transparency) to 1 (full opacity). Setting it below 1 can help
view trajectories, trajectory surfaces etc. <em>and</em> a filled base map.</p></dd>


<dt id="arg-projection">projection<a class="anchor" aria-label="anchor" href="#arg-projection"></a></dt>
<dd><p>The map projection to be used. Different map projections
are possible through the <code>mapproj</code> package. See <code>?mapproject</code> for
extensive details and information on setting other parameters and
orientation (see below).</p></dd>


<dt id="arg-parameters">parameters<a class="anchor" aria-label="anchor" href="#arg-parameters"></a></dt>
<dd><p>From the <code>mapproj</code> package. Optional numeric vector of
parameters for use with the projection argument. This argument is optional
only in the sense that certain projections do not require additional
parameters. If a projection does not require additional parameters then set
to null i.e. <code>parameters = NULL</code>.</p></dd>


<dt id="arg-orientation">orientation<a class="anchor" aria-label="anchor" href="#arg-orientation"></a></dt>
<dd><p>From the <code>mapproj</code> package. An optional vector
c(latitude, longitude, rotation) which describes where the "North Pole"
should be when computing the projection. Normally this is c(90, 0), which
is appropriate for cylindrical and conic projections. For a planar
projection, you should set it to the desired point of tangency. The third
value is a clockwise rotation (in degrees), which defaults to the midrange
of the longitude coordinates in the map.</p></dd>


<dt id="arg-by-type">by.type<a class="anchor" aria-label="anchor" href="#arg-by-type"></a></dt>
<dd><p>The percentage of the total number of trajectories is given
for all data by default. Setting <code>by.type = TRUE</code> will make each panel
add up to 100.</p></dd>


<dt id="arg-origin">origin<a class="anchor" aria-label="anchor" href="#arg-origin"></a></dt>
<dd><p>If true a filled circle dot is shown to mark the receptor
point.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other ways.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other graphical parameters passed onto <code>lattice:levelplot</code>
and <code>cutData</code>. Similarly, common axis and title labelling options
(such as <code>xlab</code>, <code>ylab</code>, <code>main</code>) are passed to
<code>levelplot</code> via <code>quickText</code> to handle routine formatting.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an <a href="openair-package.html">openair</a> object. The <code>data</code> component contains
both <code>traj</code> (the original data appended with its cluster) and <code>results</code>
(the average trajectory path per cluster, shown in the <code>trajCluster()</code>
plot.)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Two main methods are available to cluster the back trajectories using two
different calculations of the distance matrix. The default is to use the
standard Euclidian distance between each pair of trajectories. Also available
is an angle-based distance matrix based on Sirois and Bottenheim (1995). The
latter method is useful when the interest is the direction of the
trajectories in clustering.</p>
<p>The distance matrix calculations are made in C++ for speed. For data sets of
up to 1 year both methods should be relatively fast, although the
<code>method = "Angle"</code> does tend to take much longer to calculate. Further
details of these methods are given in the openair manual.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Sirois, A. and Bottenheim, J.W., 1995. Use of backward trajectories to
interpret the 5-year record of PAN and O3 ambient air concentrations at
Kejimkujik National Park, Nova Scotia. Journal of Geophysical Research, 100:
2867-2881.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other trajectory analysis functions:
<code><a href="importTraj.html">importTraj</a>()</code>,
<code><a href="trajLevel.html">trajLevel</a>()</code>,
<code><a href="trajPlot.html">trajPlot</a>()</code></p>
<p>Other cluster analysis functions:
<code><a href="polarCluster.html">polarCluster</a>()</code>,
<code><a href="timeProp.html">timeProp</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## import trajectories</span></span></span>
<span class="r-in"><span><span class="va">traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="importTraj.html">importTraj</a></span><span class="op">(</span>site <span class="op">=</span> <span class="st">"london"</span>, year <span class="op">=</span> <span class="fl">2009</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## calculate clusters</span></span></span>
<span class="r-in"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu">trajCluster</span><span class="op">(</span><span class="va">traj</span>, n.cluster <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">clust</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="co">## note new variable 'cluster'</span></span></span>
<span class="r-in"><span><span class="co">## use different distance matrix calculation, and calculate by season</span></span></span>
<span class="r-in"><span><span class="va">traj</span> <span class="op">&lt;-</span> <span class="fu">trajCluster</span><span class="op">(</span><span class="va">traj</span>, method <span class="op">=</span> <span class="st">"Angle"</span>, type <span class="op">=</span> <span class="st">"season"</span>, n.cluster <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

