<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Trajectory line plots with conditioning — trajPlot • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trajectory line plots with conditioning — trajPlot"><meta name="description" content="This function plots back trajectories. This function requires that data are
imported using the importTraj function."><meta property="og:description" content="This function plots back trajectories. This function requires that data are
imported using the importTraj function."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (external)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Trajectory line plots with conditioning</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/master/R/trajPlot.R" class="external-link"><code>R/trajPlot.R</code></a></small>
      <div class="d-none name"><code>trajPlot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function plots back trajectories. This function requires that data are
imported using the <code>importTraj</code> function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trajPlot</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"height"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  map.fill <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  map.res <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  map.cols <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>  map.alpha <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  projection <span class="op">=</span> <span class="st">"lambert"</span>,</span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">51</span>, <span class="fl">51</span><span class="op">)</span>,</span>
<span>  orientation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  grid.col <span class="op">=</span> <span class="st">"deepskyblue"</span>,</span>
<span>  npoints <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  origin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mydata">mydata<a class="anchor" aria-label="anchor" href="#arg-mydata"></a></dt>
<dd><p>Data frame, the result of importing a trajectory file using
<code>importTraj</code>.</p></dd>


<dt id="arg-lon">lon<a class="anchor" aria-label="anchor" href="#arg-lon"></a></dt>
<dd><p>Column containing the longitude, as a decimal.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>Column containing the latitude, as a decimal.</p></dd>


<dt id="arg-pollutant">pollutant<a class="anchor" aria-label="anchor" href="#arg-pollutant"></a></dt>
<dd><p>Pollutant to be plotted. By default the trajectory height is
used.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><code>type</code> determines how the data are split, i.e., conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. "season", "year", "weekday" and so on. For example,
<code>type = "season"</code> will produce four plots — one for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.</p>
<p><code>type</code> can be up length two e.g. <code>type = c("season", "weekday")</code>
will produce a 2x2 plot split by season and day of the week. Note, when two
types are provided the first forms the columns and the second the rows.</p></dd>


<dt id="arg-map">map<a class="anchor" aria-label="anchor" href="#arg-map"></a></dt>
<dd><p>Should a base map be drawn? If <code>TRUE</code> the world base map from
the <code>maps</code> package is used.</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>It is sometimes useful to group and colour trajectories
according to a grouping variable. See example below.</p></dd>


<dt id="arg-map-fill">map.fill<a class="anchor" aria-label="anchor" href="#arg-map-fill"></a></dt>
<dd><p>Should the base map be a filled polygon? Default is to fill
countries.</p></dd>


<dt id="arg-map-res">map.res<a class="anchor" aria-label="anchor" href="#arg-map-res"></a></dt>
<dd><p>The resolution of the base map. By default the function uses
the ‘world’ map from the <code>maps</code> package. If <code>map.res =
  "hires"</code> then the (much) more detailed base map ‘worldHires’ from
the <code>mapdata</code> package is used. Use <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(mapdata)</a></code>. Also
available is a map showing the US states. In this case <code>map.res =
  "state"</code> should be used.</p></dd>


<dt id="arg-map-cols">map.cols<a class="anchor" aria-label="anchor" href="#arg-map-cols"></a></dt>
<dd><p>If <code>map.fill = TRUE</code> <code>map.cols</code> controls the fill
colour. Examples include <code>map.fill = "grey40"</code> and <code>map.fill =
  openColours("default", 10)</code>. The latter colours the countries and can help
differentiate them.</p></dd>


<dt id="arg-map-alpha">map.alpha<a class="anchor" aria-label="anchor" href="#arg-map-alpha"></a></dt>
<dd><p>The transparency level of the filled map which takes values
from 0 (full transparency) to 1 (full opacity). Setting it below 1 can help
view trajectories, trajectory surfaces etc. <em>and</em> a filled base map.</p></dd>


<dt id="arg-projection">projection<a class="anchor" aria-label="anchor" href="#arg-projection"></a></dt>
<dd><p>The map projection to be used. Different map projections
are possible through the <code>mapproj</code> package. See <code>?mapproject</code> for
extensive details and information on setting other parameters and
orientation (see below).</p></dd>


<dt id="arg-parameters">parameters<a class="anchor" aria-label="anchor" href="#arg-parameters"></a></dt>
<dd><p>From the <code>mapproj</code> package. Optional numeric vector of
parameters for use with the projection argument. This argument is optional
only in the sense that certain projections do not require additional
parameters. If a projection does not require additional parameters then set
to null i.e. <code>parameters = NULL</code>.</p></dd>


<dt id="arg-orientation">orientation<a class="anchor" aria-label="anchor" href="#arg-orientation"></a></dt>
<dd><p>From the <code>mapproj</code> package. An optional vector
c(latitude, longitude, rotation) which describes where the "North Pole"
should be when computing the projection. Normally this is c(90, 0), which
is appropriate for cylindrical and conic projections. For a planar
projection, you should set it to the desired point of tangency. The third
value is a clockwise rotation (in degrees), which defaults to the midrange
of the longitude coordinates in the map.</p></dd>


<dt id="arg-grid-col">grid.col<a class="anchor" aria-label="anchor" href="#arg-grid-col"></a></dt>
<dd><p>The colour of the map grid to be used. To remove the grid set
<code>grid.col = "transparent"</code>.</p></dd>


<dt id="arg-npoints">npoints<a class="anchor" aria-label="anchor" href="#arg-npoints"></a></dt>
<dd><p>A dot is placed every <code>npoints</code> along each full
trajectory. For hourly back trajectories points are plotted every
<code>npoint</code> hours. This helps to understand where the air masses were at
particular times and get a feel for the speed of the air (points closer
together correspond to slower moving air masses). If <code>npoints = NA</code>
then no points are added.</p></dd>


<dt id="arg-origin">origin<a class="anchor" aria-label="anchor" href="#arg-origin"></a></dt>
<dd><p>If true a filled circle dot is shown to mark the receptor
point.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when analysing
data to extract plot components and plotting them in other ways.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other arguments are passed to <code>cutData</code> and
<code>scatterPlot</code>. This provides access to arguments used in both these
functions and functions that they in turn pass arguments on to. For
example, <code>plotTraj</code> passes the argument <code>cex</code> on to
<code>scatterPlot</code> which in turn passes it on to the <code>lattice</code>
function <code>xyplot</code> where it is applied to set the plot symbol size.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Several types of trajectory plot are available. <code>trajPlot</code> by default
will plot each lat/lon location showing the origin of each trajectory, if no
<code>pollutant</code> is supplied.</p>
<p>If a pollutant is given, by merging the trajectory data with concentration
data (see example below), the trajectories are colour-coded by the
concentration of <code>pollutant</code>. With a long time series there can be lots
of overplotting making it difficult to gauge the overall concentration
pattern. In these cases setting <code>alpha</code> to a low value e.g. 0.1 can
help.</p>
<p>The user can also show points instead of lines by <code>plot.type = "p"</code>.</p>
<p>Note that <code>trajPlot</code> will plot only the full length trajectories. This
should be remembered when selecting only part of a year to plot.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other trajectory analysis functions:
<code><a href="importTraj.html">importTraj</a>()</code>,
<code><a href="trajCluster.html">trajCluster</a>()</code>,
<code><a href="trajLevel.html">trajLevel</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># show a simple case with no pollutant i.e. just the trajectories</span></span></span>
<span class="r-in"><span><span class="co"># let's check to see where the trajectories were coming from when</span></span></span>
<span class="r-in"><span><span class="co"># Heathrow Airport was closed due to the Icelandic volcanic eruption</span></span></span>
<span class="r-in"><span><span class="co"># 15--21 April 2010.</span></span></span>
<span class="r-in"><span><span class="co"># import trajectories for London and plot</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">lond</span> <span class="op">&lt;-</span> <span class="fu"><a href="importTraj.html">importTraj</a></span><span class="op">(</span><span class="st">"london"</span>, <span class="fl">2010</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># well, HYSPLIT seems to think there certainly were conditions where trajectories</span></span></span>
<span class="r-in"><span><span class="co"># orginated from Iceland...</span></span></span>
<span class="r-in"><span><span class="fu">trajPlot</span><span class="op">(</span><span class="fu"><a href="selectByDate.html">selectByDate</a></span><span class="op">(</span><span class="va">lond</span>, start <span class="op">=</span> <span class="st">"15/4/2010"</span>, end <span class="op">=</span> <span class="st">"21/4/2010"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot by day, need a column that makes a date</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">lond</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">lond</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">trajPlot</span><span class="op">(</span><span class="fu"><a href="selectByDate.html">selectByDate</a></span><span class="op">(</span><span class="va">lond</span>, start <span class="op">=</span> <span class="st">"15/4/2010"</span>, end <span class="op">=</span> <span class="st">"21/4/2010"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>type <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or show each day grouped by colour, with some other options set</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="fu">trajPlot</span><span class="op">(</span><span class="fu"><a href="selectByDate.html">selectByDate</a></span><span class="op">(</span><span class="va">lond</span>, start <span class="op">=</span> <span class="st">"15/4/2010"</span>, end <span class="op">=</span> <span class="st">"21/4/2010"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>group <span class="op">=</span> <span class="st">"day"</span>, col <span class="op">=</span> <span class="st">"turbo"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, key.pos <span class="op">=</span> <span class="st">"right"</span>, key.col <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># more examples to follow linking with concentration measurements...</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

