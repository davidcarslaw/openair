<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Function to calculate time averages for data frames — timeAverage • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to calculate time averages for data frames — timeAverage"><meta name="description" content="Function to flexibly aggregate or expand data frames by different time
periods, calculating vector-averaged wind direction where appropriate. The
averaged periods can also take account of data capture rates."><meta property="og:description" content="Function to flexibly aggregate or expand data frames by different time
periods, calculating vector-averaged wind direction where appropriate. The
averaged periods can also take account of data capture rates."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (external)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Function to calculate time averages for data frames</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/master/R/timeAverage.R" class="external-link"><code>R/timeAverage.R</code></a></small>
      <div class="d-none name"><code>timeAverage.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to flexibly aggregate or expand data frames by different time
periods, calculating vector-averaged wind direction where appropriate. The
averaged periods can also take account of data capture rates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">timeAverage</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  avg.time <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  data.thresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  start.date <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  end.date <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  interval <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  vector.ws <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mydata">mydata<a class="anchor" aria-label="anchor" href="#arg-mydata"></a></dt>
<dd><p>A data frame containing a <code>date</code> field . Can be class
<code>POSIXct</code> or <code>Date</code>.</p></dd>


<dt id="arg-avg-time">avg.time<a class="anchor" aria-label="anchor" href="#arg-avg-time"></a></dt>
<dd><p>This defines the time period to average to. Can be
“sec”, “min”, “hour”, “day”, “DSTday”,
“week”, “month”, “quarter” or “year”. For much
increased flexibility a number can precede these options followed by a
space. For example, a timeAverage of 2 months would be <code>period = "2
  month"</code>. In addition, <code>avg.time</code> can equal “season”, in which
case 3-month seasonal values are calculated with spring defined as March,
April, May and so on.</p>
<p>Note that <code>avg.time</code> can be <em>less</em> than the time interval of the
original series, in which case the series is expanded to the new time
interval. This is useful, for example, for calculating a 15-minute time
series from an hourly one where an hourly value is repeated for each new
15-minute period. Note that when expanding data in this way it is necessary
to ensure that the time interval of the original series is an exact
multiple of <code>avg.time</code> e.g. hour to 10 minutes, day to hour. Also, the
input time series must have consistent time gaps between successive
intervals so that <code>timeAverage</code> can work out how much ‘padding’
to apply. To pad-out data in this way choose <code>fill = TRUE</code>.</p></dd>


<dt id="arg-data-thresh">data.thresh<a class="anchor" aria-label="anchor" href="#arg-data-thresh"></a></dt>
<dd><p>The data capture threshold to use (%). A value of zero
means that all available data will be used in a particular period
regardless if of the number of values available. Conversely, a value of 100
will mean that all data will need to be present for the average to be
calculated, else it is recorded as <code>NA</code>. See also <code>interval</code>,
<code>start.date</code> and <code>end.date</code> to see whether it is advisable to set
these other options.</p></dd>


<dt id="arg-statistic">statistic<a class="anchor" aria-label="anchor" href="#arg-statistic"></a></dt>
<dd><p>The statistic to apply when aggregating the data; default is
the mean. Can be one of “mean”, “max”, “min”,
“median”, “frequency”, “sum”, “sd”,
“percentile”. Note that “sd” is the standard deviation,
“frequency” is the number (frequency) of valid records in the period
and “data.cap” is the percentage data capture. “percentile”
is the percentile level (%) between 0-100, which can be set using the
“percentile” option — see below. Not used if <code>avg.time =
  "default"</code>.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><code>type</code> allows <code>timeAverage</code> to be applied to cases
where there are groups of data that need to be split and the function
applied to each group. The most common example is data with multiple sites
identified with a column representing site name e.g. <code>type = "site"</code>.
More generally, <code>type</code> should be used where the date repeats for a
particular grouping variable. However, if type is not supplied the data
will still be averaged but the grouping variables (character or factor)
will be dropped.</p></dd>


<dt id="arg-percentile">percentile<a class="anchor" aria-label="anchor" href="#arg-percentile"></a></dt>
<dd><p>The percentile level used when <code>statistic =
"percentile"</code>. The default is 95%.</p></dd>


<dt id="arg-start-date">start.date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>A string giving a start date to use. This is sometimes
useful if a time series starts between obvious intervals. For example, for
a 1-minute time series that starts “2009-11-29 12:07:00” that needs
to be averaged up to 15-minute means, the intervals would be
“2009-11-29 12:07:00”, “2009-11-29 12:22:00” etc. Often,
however, it is better to round down to a more obvious start point e.g.
“2009-11-29 12:00:00” such that the sequence is then
“2009-11-29 12:00:00”, “2009-11-29 12:15:00” ...
<code>start.date</code> is therefore used to force this type of sequence.</p></dd>


<dt id="arg-end-date">end.date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>A string giving an end date to use. This is sometimes useful
to make sure a time series extends to a known end point and is useful when
<code>data.thresh</code> &gt; 0 but the input time series does not extend up to the
final full interval. For example, if a time series ends sometime in October
but annual means are required with a data capture of &gt;75 % then it is
necessary to extend the time series up until the end of the year. Input in
the format yyyy-mm-dd HH:MM.</p></dd>


<dt id="arg-interval">interval<a class="anchor" aria-label="anchor" href="#arg-interval"></a></dt>
<dd><p>The <code>timeAverage</code> function tries to determine the
interval of the original time series (e.g. hourly) by calculating the most
common interval between time steps. The interval is needed for calculations
where the <code>data.thresh</code> &gt;0. For the vast majority of regular time
series this works fine. However, for data with very poor data capture or
irregular time series the automatic detection may not work. Also, for time
series such as monthly time series where there is a variable difference in
time between months users should specify the time interval explicitly e.g.
<code>interval = "month"</code>. Users can also supply a time interval to
<em>force</em> on the time series. See <code>avg.time</code> for the format.</p>
<p>This option can sometimes be useful with <code>start.date</code> and
<code>end.date</code> to ensure full periods are considered e.g. a full year when
<code>avg.time = "year"</code>.</p></dd>


<dt id="arg-vector-ws">vector.ws<a class="anchor" aria-label="anchor" href="#arg-vector-ws"></a></dt>
<dd><p>Should vector averaging be carried out on wind speed if
available? The default is <code>FALSE</code> and scalar averages are calculated.
Vector averaging of the wind speed is carried out on the u and v wind
components. For example, consider the average of two hours where the wind
direction and speed of the first hour is 0 degrees and 2m/s and 180 degrees
and 2m/s for the second hour. The scalar average of the wind speed is
simply the arithmetic average = 2m/s and the vector average is 0m/s.
Vector-averaged wind speeds will always be lower than scalar-averaged
values.</p></dd>


<dt id="arg-fill">fill<a class="anchor" aria-label="anchor" href="#arg-fill"></a></dt>
<dd><p>When time series are expanded i.e. when a time interval is less
than the original time series, data are ‘padded out’ with <code>NA</code>.
To ‘pad-out’ the additional data with the first row in each original
time interval, choose <code>fill = TRUE</code>.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Show a progress bar when many groups make up <code>type</code>? Defaults
to <code>TRUE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments for other functions calling
<code>timeAverage</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a data frame with date in class <code>POSIXct</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function calculates time averages for a data frame. It also treats wind
direction correctly through vector-averaging. For example, the average of 350
degrees and 10 degrees is either 0 or 360 - not 180. The calculations
therefore average the wind components.</p>
<p>When a data capture threshold is set through <code>data.thresh</code> it is
necessary for <code>timeAverage</code> to know what the original time interval of
the input time series is. The function will try and calculate this interval
based on the most common time gap (and will print the assumed time gap to the
screen). This works fine most of the time but there are occasions where it
may not e.g. when very few data exist in a data frame or the data are monthly
(i.e. non-regular time interval between months). In this case the user can
explicitly specify the interval through <code>interval</code> in the same format as
<code>avg.time</code> e.g. <code>interval = "month"</code>. It may also be useful to set
<code>start.date</code> and <code>end.date</code> if the time series do not span the
entire period of interest. For example, if a time series ended in October and
annual means are required, setting <code>end.date</code> to the end of the year
will ensure that the whole period is covered and that <code>data.thresh</code> is
correctly calculated. The same also goes for a time series that starts later
in the year where <code>start.date</code> should be set to the beginning of the
year.</p>
<p><code>timeAverage</code> should be useful in many circumstances where it is
necessary to work with different time average data. For example, hourly air
pollution data and 15-minute meteorological data. To merge the two data sets
<code>timeAverage</code> can be used to make the meteorological data 1-hour means
first. Alternatively, <code>timeAverage</code> can be used to expand the hourly
data to 15 minute data - see example below.</p>
<p>For the research community <code>timeAverage</code> should be useful for dealing
with outputs from instruments where there are a range of time periods used.</p>
<p>It is also very useful for plotting data using <code><a href="timePlot.html">timePlot</a></code>. Often
the data are too dense to see patterns and setting different averaging
periods easily helps with interpretation.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See <code><a href="timePlot.html">timePlot</a></code> that plots time series data and uses
<code>timeAverage</code> to aggregate data where necessary.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## daily average values</span></span></span>
<span class="r-in"><span><span class="va">daily</span> <span class="op">&lt;-</span> <span class="fu">timeAverage</span><span class="op">(</span><span class="va">mydata</span>, avg.time <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## daily average values ensuring at least 75 % data capture</span></span></span>
<span class="r-in"><span><span class="co">## i.e. at least 18 valid hours</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="va">daily</span> <span class="op">&lt;-</span> <span class="fu">timeAverage</span><span class="op">(</span><span class="va">mydata</span>, avg.time <span class="op">=</span> <span class="st">"day"</span>, data.thresh <span class="op">=</span> <span class="fl">75</span><span class="op">)</span> <span class="co"># \dontrun{}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## 2-weekly averages</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="va">fortnight</span> <span class="op">&lt;-</span> <span class="fu">timeAverage</span><span class="op">(</span><span class="va">mydata</span>, avg.time <span class="op">=</span> <span class="st">"2 week"</span><span class="op">)</span> <span class="co"># \dontrun{}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## make a 15-minute time series from an hourly one</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">min15</span> <span class="op">&lt;-</span>  <span class="fu">timeAverage</span><span class="op">(</span><span class="va">mydata</span>, avg.time <span class="op">=</span> <span class="st">"15 min"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># average by grouping variable</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="importUKAQ-wrapper.html">importAURN</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kc1"</span>, <span class="st">"my1"</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">2011</span><span class="op">:</span><span class="fl">2013</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">timeAverage</span><span class="op">(</span><span class="va">dat</span>, avg.time <span class="op">=</span> <span class="st">"year"</span>, type <span class="op">=</span> <span class="st">"site"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can also retain site code</span></span></span>
<span class="r-in"><span><span class="fu">timeAverage</span><span class="op">(</span><span class="va">dat</span>, avg.time <span class="op">=</span> <span class="st">"year"</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="st">"code"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or just average all the data, dropping site/code</span></span></span>
<span class="r-in"><span><span class="fu">timeAverage</span><span class="op">(</span><span class="va">dat</span>, avg.time <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

