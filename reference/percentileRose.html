<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="percentileRose plots percentiles by wind direction with flexible
conditioning. The plot can display multiple percentile lines or filled areas."><title>Function to plot percentiles by wind direction — percentileRose • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to plot percentiles by wind direction — percentileRose"><meta property="og:description" content="percentileRose plots percentiles by wind direction with flexible
conditioning. The plot can display multiple percentile lines or filled areas."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18-2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Function to plot percentiles by wind direction</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/HEAD/R/percentileRose.R" class="external-link"><code>R/percentileRose.R</code></a></small>
      <div class="d-none name"><code>percentileRose.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>percentileRose</code> plots percentiles by wind direction with flexible
conditioning. The plot can display multiple percentile lines or filled areas.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">percentileRose</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  wd <span class="op">=</span> <span class="st">"wd"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">90</span>, <span class="fl">95</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  angle <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  mean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mean.lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  mean.lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  mean.col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  intervals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  angle.scale <span class="op">=</span> <span class="fl">45</span>,</span>
<span>  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  key.header <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  key.footer <span class="op">=</span> <span class="st">"percentile"</span>,</span>
<span>  key.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>  key <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mydata</dt>
<dd><p>A data frame minimally containing <code>wd</code> and a numeric field
to plot --- <code>pollutant</code>.</p></dd>


<dt>pollutant</dt>
<dd><p>Mandatory. A pollutant name corresponding to a variable in a
data frame should be supplied e.g. <code>pollutant = "nox"</code>. More than one
pollutant can be supplied e.g. <code>pollutant = c("no2", "o3")</code> provided
there is only one <code>type</code>.</p></dd>


<dt>wd</dt>
<dd><p>Name of wind direction field.</p></dd>


<dt>type</dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. “season”, “year”, “weekday” and so
on. For example, <code>type = "season"</code> will produce four plots --- one for
each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.</p>
<p>Type can be up length two e.g. <code>type = c("season", "weekday")</code> will
produce a 2x2 plot split by season and day of the week. Note, when two
types are provided the first forms the columns and the second the rows.</p></dd>


<dt>percentile</dt>
<dd><p>The percentile value(s) to plot. Must be between 0--100. If
<code>percentile = NA</code> then only a mean line will be shown.</p></dd>


<dt>smooth</dt>
<dd><p>Should the wind direction data be smoothed using a cyclic
spline?</p></dd>


<dt>method</dt>
<dd><p>When <code>method = "default"</code> the supplied percentiles by wind
direction are calculated. When <code>method = "cpf"</code> the conditional
probability function (CPF) is plotted and a single (usually high)
percentile level is supplied. The CPF is defined as CPF = my/ny, where my
is the number of samples in the wind sector y with mixing ratios greater
than the <em>overall</em> percentile concentration, and ny is the total
number of samples in the same wind sector (see Ashbaugh et al., 1985).</p></dd>


<dt>cols</dt>
<dd><p>Colours to be used for plotting. Options include
“default”, “increment”, “heat”, “jet” and
<code>RColorBrewer</code> colours --- see the <code>openair</code> <code>openColours</code>
function for more details. For user defined the user can supply a list of
colour names recognised by R (type <code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colours()</a></code> to see the full list).
An example would be <code>cols = c("yellow", "green", "blue")</code>. <code>cols</code>
can also take the values <code>"viridis"</code>, <code>"magma"</code>,
<code>"inferno"</code>, or <code>"plasma"</code> which are the viridis colour maps
ported from Python's Matplotlib library.</p></dd>


<dt>angle</dt>
<dd><p>Default angle of “spokes” is when <code>smooth = FALSE</code>.</p></dd>


<dt>mean</dt>
<dd><p>Show the mean by wind direction as a line?</p></dd>


<dt>mean.lty</dt>
<dd><p>Line type for mean line.</p></dd>


<dt>mean.lwd</dt>
<dd><p>Line width for mean line.</p></dd>


<dt>mean.col</dt>
<dd><p>Line colour for mean line.</p></dd>


<dt>fill</dt>
<dd><p>Should the percentile intervals be filled (default) or should
lines be drawn (<code>fill = FALSE</code>).</p></dd>


<dt>intervals</dt>
<dd><p>User-supplied intervals for the scale e.g. <code>intervals =
c(0, 10, 30, 50)</code></p></dd>


<dt>angle.scale</dt>
<dd><p>Sometimes the placement of the scale may interfere with an
interesting feature. The user can therefore set <code>angle.scale</code> to any
value between 0 and 360 degrees to mitigate such problems. For example
<code>angle.scale = 45</code> will draw the scale heading in a NE direction.</p></dd>


<dt>auto.text</dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the `2' in NO2.</p></dd>


<dt>key.header</dt>
<dd><p>Adds additional text/labels to the scale key. For example,
passing the options <code>key.header = "header", key.footer = "footer1"</code>
adds addition text above and below the scale key. These arguments are
passed to <code>drawOpenKey</code> via <code>quickText</code>, applying the
<code>auto.text</code> argument, to handle formatting.</p></dd>


<dt>key.footer</dt>
<dd><p>see <code>key.footer</code>.</p></dd>


<dt>key.position</dt>
<dd><p>Location where the scale key is to plotted. Allowed
arguments currently include <code>"top"</code>, <code>"right"</code>, <code>"bottom"</code>
and <code>"left"</code>.</p></dd>


<dt>key</dt>
<dd><p>Fine control of the scale key via <code>drawOpenKey</code>. See
<code>drawOpenKey</code> for further details.</p></dd>


<dt>alpha</dt>
<dd><p>The alpha transparency to use for the plotting surface (a value
between 0 and 1 with zero being fully transparent and 1 fully opaque).
Setting a value below 1 can be useful when plotting surfaces on a map using
the package <code>openairmaps</code>.</p></dd>


<dt>plot</dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other ways.</p></dd>


<dt>...</dt>
<dd><p>Other graphical parameters are passed onto <code>cutData</code> and
<code>lattice:xyplot</code>. For example, <code>percentileRose</code> passes the option
<code>hemisphere = "southern"</code> on to <code>cutData</code> to provide southern
(rather than default northern) hemisphere handling of <code>type =
  "season"</code>. Similarly, common graphical arguments, such as <code>xlim</code> and
<code>ylim</code> for plotting ranges and <code>lwd</code> for line thickness when
using <code>fill = FALSE</code>, are passed on <code>xyplot</code>, although some local
modifications may be applied by openair. For example, axis and title
labelling options (such as <code>xlab</code>, <code>ylab</code> and <code>main</code>) are
passed to <code>xyplot</code> via <code>quickText</code> to handle routine formatting.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an <a href="openair-package.html">openair</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>percentileRose</code> calculates percentile levels of a pollutant and plots
them by wind direction. One or more percentile levels can be calculated and
these are displayed as either filled areas or as lines.</p>
<p>The wind directions are rounded to the nearest 10 degrees, consistent with
surface data from the UK Met Office before a smooth is fitted. The levels by
wind direction are optionally calculated using a cyclic smooth cubic spline
using the option <code>smooth</code>. If <code>smooth = FALSE</code> then the data are
shown in 10 degree sectors.</p>
<p>The <code>percentileRose</code> function compliments other similar functions
including <code><a href="windRose.html">windRose</a></code>, <code><a href="pollutionRose.html">pollutionRose</a></code>,
<code><a href="polarFreq.html">polarFreq</a></code> or <code><a href="polarPlot.html">polarPlot</a></code>. It is most useful for
showing the distribution of concentrations by wind direction and often can
reveal different sources e.g. those that only affect high percentile
concentrations such as a chimney stack.</p>
<p>Similar to other functions, flexible conditioning is available through the
<code>type</code> option. It is easy for example to consider multiple percentile
values for a pollutant by season, year and so on. See examples below.</p>
<p><code>percentileRose</code> also offers great flexibility with the scale used and
the user has fine control over both the range, interval and colour.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ashbaugh, L.L., Malm, W.C., Sadeh, W.Z., 1985. A residence time
probability analysis of sulfur concentrations at ground canyon national
park. Atmospheric Environment 19 (8), 1263-1270.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other polar directional analysis functions: 
<code><a href="polarAnnulus.html">polarAnnulus</a>()</code>,
<code><a href="polarCluster.html">polarCluster</a>()</code>,
<code><a href="polarDiff.html">polarDiff</a>()</code>,
<code><a href="polarFreq.html">polarFreq</a>()</code>,
<code><a href="polarPlot.html">polarPlot</a>()</code>,
<code><a href="pollutionRose.html">pollutionRose</a>()</code>,
<code><a href="windRose.html">windRose</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># basic percentile plot</span></span></span>
<span class="r-in"><span><span class="fu">percentileRose</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="percentileRose-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 50/95th percentiles of ozone, with different colours</span></span></span>
<span class="r-in"><span><span class="fu">percentileRose</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span>, percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">95</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"brewer1"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="percentileRose-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># percentiles of ozone by year, with different colours</span></span></span>
<span class="r-in"><span><span class="fu">percentileRose</span><span class="op">(</span><span class="va">mydata</span>, type <span class="op">=</span> <span class="st">"year"</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span>, col <span class="op">=</span> <span class="st">"brewer1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># percentile concentrations by season and day/nighttime..</span></span></span>
<span class="r-in"><span><span class="fu">percentileRose</span><span class="op">(</span><span class="va">mydata</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"daylight"</span><span class="op">)</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span>, col <span class="op">=</span> <span class="st">"brewer1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

