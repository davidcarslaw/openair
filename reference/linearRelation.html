<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function considers linear relationships between two pollutants. The
relationships are calculated on different times bases using a linear model.
The slope and 95% confidence interval in slope relationships by time unit are
plotted in many ways. The function is particularly useful when considering
whether relationships are consistent with emissions inventories."><title>Linear relations between pollutants — linearRelation • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linear relations between pollutants — linearRelation"><meta property="og:description" content="This function considers linear relationships between two pollutants. The
relationships are calculated on different times bases using a linear model.
The slope and 95% confidence interval in slope relationships by time unit are
plotted in many ways. The function is particularly useful when considering
whether relationships are consistent with emissions inventories."><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.17.0.9008</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Linear relations between pollutants</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/HEAD/R/linearRelation.R" class="external-link"><code>R/linearRelation.R</code></a></small>
      <div class="d-none name"><code>linearRelation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function considers linear relationships between two pollutants. The
relationships are calculated on different times bases using a linear model.
The slope and 95% confidence interval in slope relationships by time unit are
plotted in many ways. The function is particularly useful when considering
whether relationships are consistent with emissions inventories.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">linearRelation</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"no2"</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>  condition <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  rsq.thresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slope from "</span>, <span class="va">y</span>, <span class="st">" = m."</span>, <span class="va">x</span>, <span class="st">" + c"</span><span class="op">)</span>,</span>
<span>  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"grey30"</span>,</span>
<span>  date.breaks <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mydata</dt>
<dd><p>A data frame minimally containing <code>date</code> and two
pollutants.</p></dd>


<dt>x</dt>
<dd><p>First pollutant that when plotted would appear on the x-axis of a
relationship e.g. <code>x = "nox"</code>.</p></dd>


<dt>y</dt>
<dd><p>Second pollutant that when plotted would appear on the y-axis of a
relationship e.g. <code>y = "pm10"</code>.</p></dd>


<dt>period</dt>
<dd><p>A range of different time periods can be analysed. The default
is <code>month</code> but can be <code>year</code> and <code>week</code>. For increased
flexibility an integer can be used e.g. for 3-month values <code>period =
  "3 month"</code>. Other cases include <code>"hour"</code> will show the diurnal
relationship between <code>x</code> and <code>y</code> and “weekday” the day of
the week relationship between <code>x</code> and <code>y</code>. “day.hour” will
plot the relationship by weekday and hour of the day.</p></dd>


<dt>condition</dt>
<dd><p>For <code>period = "hour"</code>, <code>period = "day"</code> and
<code>period = "day.hour"</code>, setting <code>condition = TRUE</code> will plot the
relationships split by year. This is useful for seeing how the
relationships may be changing over time.</p></dd>


<dt>n</dt>
<dd><p>The minimum number of points to be sent to the linear model.
Because there may only be a few points e.g. hours where two pollutants are
available over one week, <code>n</code> can be set to ensure that at least
<code>n</code> points are sent to the linear model. If a period has hours &lt;
<code>n</code> that period will be ignored.</p></dd>


<dt>rsq.thresh</dt>
<dd><p>The minimum correlation coefficient (R2) allowed. If the
relationship between <code>x</code> and <code>y</code> is not very good for a
particular period, setting <code>rsq.thresh</code> can help to remove those
periods where the relationship is not strong. Any R2 values below
<code>rsq.thresh</code> will not be plotted.</p></dd>


<dt>ylab</dt>
<dd><p>y-axis title, specified by the user.</p></dd>


<dt>auto.text</dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If <code>TRUE</code>
titles and axis labels will automatically try and format pollutant names
and units properly e.g.  by subscripting the ‘2’ in NO2.</p></dd>


<dt>cols</dt>
<dd><p>Colour for the points and uncertainty intervals.</p></dd>


<dt>date.breaks</dt>
<dd><p>Number of major x-axis intervals to use. The function will
try and choose a sensible number of dates/times as well as formatting the
date/time appropriately to the range being considered.  This does not
always work as desired automatically. The user can therefore increase or
decrease the number of intervals by adjusting the value of
<code>date.breaks</code> up or down.</p></dd>


<dt>plot</dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other ways.</p></dd>


<dt>...</dt>
<dd><p>Other graphical parameters. A useful one to remove the strip with
the date range on at the top of the plot is to set <code>strip = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an <a href="openair-package.html">openair</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The relationships between pollutants can yield some very useful information
about source emissions and how they change. A scatterPlot between two
pollutants is the usual way to investigate the relationship. A linear
regression is useful to test the strength of the relationship. However,
considerably more information can be gleaned by considering different time
periods, such as how the relationship between two pollutants vary over time,
by day of the week, diurnally and so on. The <code>linearRelation</code> function
does just that - it fits a linear relationship between two pollutants over a
wide range of time periods determined by <code>period</code>.</p>
<p><code>linearRelation</code> function is particularly useful if background
concentrations are first removed from roadside concentrations, as the
increment will relate more directly with changes in emissions. In this
respect, using <code>linearRelation</code> can provide valuable information on how
emissions may have changed over time, by hour of the day etc. Using the
function in this way will require users to do some basic manipulation with
their data first.</p>
<p>If a data frame is supplied that contains <code>nox</code>, <code>no2</code> and
<code>o3</code>, the <code>y</code> can be chosen as <code>y = "ox"</code>. In function will
therefore consider total oxidant slope (sum of NO2 + O3), which can provide
valuable information on likely vehicle primary NO emissions. Note, however,
that most roadside sites do not have ozone measurements and
<code><a href="calcFno2.html">calcFno2</a></code> is the alternative.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="calcFno2.html">calcFno2()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># monthly relationship between NOx and SO2 - note rapid fall in</span></span></span>
<span class="r-in"><span><span class="co"># ratio at the beginning of the series</span></span></span>
<span class="r-in"><span><span class="fu">linearRelation</span><span class="op">(</span><span class="va">mydata</span>, x <span class="op">=</span> <span class="st">"nox"</span>, y <span class="op">=</span> <span class="st">"so2"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="linearRelation-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># monthly relationship between NOx and SO2 - note rapid fall in</span></span></span>
<span class="r-in"><span><span class="co"># ratio at the beginning of the series</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">linearRelation</span><span class="op">(</span><span class="va">mydata</span>, x <span class="op">=</span> <span class="st">"nox"</span>, y <span class="op">=</span> <span class="st">"ox"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># diurnal oxidant slope by year # clear change in magnitude</span></span></span>
<span class="r-in"><span><span class="co"># starting 2003, but the diurnal profile has also changed: the</span></span></span>
<span class="r-in"><span><span class="co"># morning and evening peak hours are more important, presumably</span></span></span>
<span class="r-in"><span><span class="co"># due to change in certain vehicle types</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">linearRelation</span><span class="op">(</span><span class="va">mydata</span>, x <span class="op">=</span> <span class="st">"nox"</span>, y <span class="op">=</span> <span class="st">"ox"</span>, period <span class="op">=</span> <span class="st">"hour"</span>, condition <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># PM2.5/PM10 ratio, but only plot where monthly R2 &gt;= 0.8</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">linearRelation</span><span class="op">(</span><span class="va">mydata</span>, x <span class="op">=</span> <span class="st">"pm10"</span>, y <span class="op">=</span> <span class="st">"pm25"</span>, rsq.thresh <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

