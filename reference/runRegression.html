<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rolling regression for pollutant source characterisation. — runRegression • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rolling regression for pollutant source characterisation. — runRegression"><meta name="description" content='This function calculates rolling regressions for input data with a set window
width. The principal use of the function is to identify "dilution lines"
where the ratio between two pollutant concentrations is invariant. The
original idea is based on the work of Bentley (2004).'><meta property="og:description" content='This function calculates rolling regressions for input data with a set window
width. The principal use of the function is to identify "dilution lines"
where the ratio between two pollutant concentrations is invariant. The
original idea is based on the work of Bentley (2004).'><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (external)</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Rolling regression for pollutant source characterisation.</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/master/R/runRegression.R" class="external-link"><code>R/runRegression.R</code></a></small>
      <div class="d-none name"><code>runRegression.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates rolling regressions for input data with a set window
width. The principal use of the function is to identify "dilution lines"
where the ratio between two pollutant concentrations is invariant. The
original idea is based on the work of Bentley (2004).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">runRegression</span><span class="op">(</span><span class="va">mydata</span>, x <span class="op">=</span> <span class="st">"nox"</span>, y <span class="op">=</span> <span class="st">"pm10"</span>, run.len <span class="op">=</span> <span class="fl">3</span>, date.pad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mydata">mydata<a class="anchor" aria-label="anchor" href="#arg-mydata"></a></dt>
<dd><p>A data frame with  columns for <code>date</code> and at least two
variables for use in a regression.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>The column name of the <code>x</code> variable for use in a linear
regression <code>y = m.x + c</code>.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>The column name of the <code>y</code> variable for use in a linear
regression <code>y = m.x + c</code>.</p></dd>


<dt id="arg-run-len">run.len<a class="anchor" aria-label="anchor" href="#arg-run-len"></a></dt>
<dd><p>The window width to be used for a rolling regression. A value
of 3 for example for hourly data will consider 3 one-hour time sequences.</p></dd>


<dt id="arg-date-pad">date.pad<a class="anchor" aria-label="anchor" href="#arg-date-pad"></a></dt>
<dd><p>Should gaps in time series be filled before calculations are
made?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble with <code>date</code> and calculated regression coefficients and
other information to plot dilution lines.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The intended use is to apply the approach to air pollution data to extract
consecutive points in time where the ratio between two pollutant
concentrations changes by very little. By filtering the output for high R2
values (typically more than 0.90 to 0.95), conditions where local source
dilution is dominant can be isolated for post processing. The function is
more fully described and used in the <code>openair</code> online manual, together
with examples.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>For original inspiration:</p>
<p>Bentley, S. T. (2004). Graphical techniques for constraining estimates of
aerosol emissions from motor vehicles using air monitoring network data.
Atmospheric Environment,(10), 1491–1500.
https://doi.org/10.1016/j.atmosenv.2003.11.033</p>
<p>Example for vehicle emissions high time resolution data:</p>
<p>Farren, N. J., Schmidt, C., Juchem, H., Pöhler, D., Wilde, S. E., Wagner, R.
L., Wilson, S., Shaw, M. D., &amp; Carslaw, D. C. (2023). Emission ratio
determination from road vehicles using a range of remote emission sensing
techniques. Science of The Total Environment, 875.
https://doi.org/10.1016/j.scitotenv.2023.162621.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other time series and trend functions:
<code><a href="TheilSen.html">TheilSen</a>()</code>,
<code><a href="calendarPlot.html">calendarPlot</a>()</code>,
<code><a href="smoothTrend.html">smoothTrend</a>()</code>,
<code><a href="timePlot.html">timePlot</a>()</code>,
<code><a href="timeProp.html">timeProp</a>()</code>,
<code><a href="timeVariation.html">timeVariation</a>()</code>,
<code><a href="trendLevel.html">trendLevel</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Just use part of a year of data</span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">runRegression</span><span class="op">(</span><span class="fu"><a href="selectByDate.html">selectByDate</a></span><span class="op">(</span><span class="va">mydata</span>, year <span class="op">=</span> <span class="fl">2004</span>, month <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>x <span class="op">=</span> <span class="st">"nox"</span>, y <span class="op">=</span> <span class="st">"pm10"</span>, run.len <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">output</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2,073 × 12</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    date                date_start          date_end            intercept   slope</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2004-01-01 <span style="color: #949494;">01:00:00</span> 2004-01-01 <span style="color: #949494;">00:00:00</span> 2004-01-01 <span style="color: #949494;">02:00:00</span>    47.4   -<span style="color: #BB0000;">0.199</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2004-01-01 <span style="color: #949494;">02:00:00</span> 2004-01-01 <span style="color: #949494;">01:00:00</span> 2004-01-01 <span style="color: #949494;">03:00:00</span>     2.15   0.099<span style="text-decoration: underline;">6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2004-01-01 <span style="color: #949494;">03:00:00</span> 2004-01-01 <span style="color: #949494;">02:00:00</span> 2004-01-01 <span style="color: #949494;">04:00:00</span>     1.87   0.089<span style="text-decoration: underline;">8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2004-01-01 <span style="color: #949494;">04:00:00</span> 2004-01-01 <span style="color: #949494;">03:00:00</span> 2004-01-01 <span style="color: #949494;">05:00:00</span>     2.39   0.089<span style="text-decoration: underline;">7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2004-01-01 <span style="color: #949494;">05:00:00</span> 2004-01-01 <span style="color: #949494;">04:00:00</span> 2004-01-01 <span style="color: #949494;">06:00:00</span>   -<span style="color: #BB0000;">10.6</span>    0.297 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2004-01-01 <span style="color: #949494;">06:00:00</span> 2004-01-01 <span style="color: #949494;">05:00:00</span> 2004-01-01 <span style="color: #949494;">07:00:00</span>    20.0   -<span style="color: #BB0000;">0.167</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2004-01-01 <span style="color: #949494;">07:00:00</span> 2004-01-01 <span style="color: #949494;">06:00:00</span> 2004-01-01 <span style="color: #949494;">08:00:00</span>     8.76   0.012<span style="text-decoration: underline;">9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2004-01-01 <span style="color: #949494;">08:00:00</span> 2004-01-01 <span style="color: #949494;">07:00:00</span> 2004-01-01 <span style="color: #949494;">09:00:00</span>     5.81   0.059<span style="text-decoration: underline;">6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2004-01-01 <span style="color: #949494;">09:00:00</span> 2004-01-01 <span style="color: #949494;">08:00:00</span> 2004-01-01 <span style="color: #949494;">10:00:00</span>     0.108  0.113 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2004-01-01 <span style="color: #949494;">10:00:00</span> 2004-01-01 <span style="color: #949494;">09:00:00</span> 2004-01-01 <span style="color: #949494;">11:00:00</span>    -<span style="color: #BB0000;">5.59</span>   0.149 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2,063 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 7 more variables: r_squared &lt;dbl&gt;, nox_1 &lt;dbl&gt;, nox_2 &lt;dbl&gt;, pm10_1 &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   pm10_2 &lt;dbl&gt;, delta_nox &lt;dbl&gt;, delta_pm10 &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

