<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Use non-parametric methods to calculate time series trends"><title>Calculate nonparametric smooth trends — smoothTrend • openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate nonparametric smooth trends — smoothTrend"><meta property="og:description" content="Use non-parametric methods to calculate time series trends"><meta property="og:image" content="https://davidcarslaw.github.io/openair/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light" data-bs-theme="default"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate nonparametric smooth trends</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/HEAD/R/smoothTrend.R" class="external-link"><code>R/smoothTrend.R</code></a></small>
      <div class="d-none name"><code>smoothTrend.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use non-parametric methods to calculate time series trends</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">smoothTrend</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  deseason <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  avg.time <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  data.thresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  simulate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  autocor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cols <span class="op">=</span> <span class="st">"brewer1"</span>,</span>
<span>  shade <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  y.relation <span class="op">=</span> <span class="st">"same"</span>,</span>
<span>  ref.x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref.y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  key.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">percentile</span><span class="op">)</span>,</span>
<span>  name.pol <span class="op">=</span> <span class="va">pollutant</span>,</span>
<span>  ci <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  date.breaks <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  k <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mydata</dt>
<dd><p>A data frame containing the field <code>date</code> and at least one
other parameter for which a trend test is required; typically (but not
necessarily) a pollutant.</p></dd>


<dt>pollutant</dt>
<dd><p>The parameter for which a trend test is required.
Mandatory.</p></dd>


<dt>deseason</dt>
<dd><p>Should the data be de-deasonalized first? If <code>TRUE</code> the
function <code>stl</code> is used (seasonal trend decomposition using loess).
Note that if <code>TRUE</code> missing data are first imputed using a
Kalman filter and Kalman smooth.</p></dd>


<dt>type</dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
and then plotted. The default is will produce a single plot using the
entire data. Type can be one of the built-in types as detailed in
<code>cutData</code> e.g. “season”, “year”, “weekday” and
so on. For example, <code>type = "season"</code> will produce four plots --- one
for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
frame. If that variable is numeric, then the data will be split into four
quantiles (if possible) and labelled accordingly. If type is an existing
character or factor variable, then those categories/levels will be used
directly. This offers great flexibility for understanding the variation of
different variables and how they depend on one another.</p>
<p>Type can be up length two e.g. <code>type = c("season", "weekday")</code> will
produce a 2x2 plot split by season and day of the week. Note, when two
types are provided the first forms the columns and the second the rows.</p></dd>


<dt>statistic</dt>
<dd><p>Statistic used for calculating monthly values. Default is
“mean”, but can also be “percentile”. See <code>timeAverage</code>
for more details.</p></dd>


<dt>avg.time</dt>
<dd><p>Can be “month” (the default), “season” or
“year”. Determines the time over which data should be averaged.
Note that for “year”, six or more years are required. For
“season” the data are plit up into spring: March, April, May etc.
Note that December is considered as belonging to winter of the following
year.</p></dd>


<dt>percentile</dt>
<dd><p>Percentile value(s) to use if <code>statistic =
  "percentile"</code> is chosen. Can be a vector of numbers e.g. <code>percentile
  = c(5, 50, 95)</code> will plot the 5th, 50th and 95th percentile values
together on the same plot.</p></dd>


<dt>data.thresh</dt>
<dd><p>The data capture threshold to use (%) when aggregating
the data using <code>avg.time</code>. A value of zero means that all available
data will be used in a particular period regardless if of the number of
values available. Conversely, a value of 100 will mean that all data will
need to be present for the average to be calculated, else it is recorded
as <code>NA</code>. Not used if <code>avg.time = "default"</code>.</p></dd>


<dt>simulate</dt>
<dd><p>Should simulations be carried out to determine the
Mann-Kendall tau and p-value. The default is <code>FALSE</code>. If <code>TRUE</code>,
bootstrap simulations are undertaken, which also account for
autocorrelation.</p></dd>


<dt>n</dt>
<dd><p>Number of bootstrap simulations if <code>simulate = TRUE</code>.</p></dd>


<dt>autocor</dt>
<dd><p>Should autocorrelation be considered in the trend uncertainty
estimates? The default is <code>FALSE</code>. Generally, accounting for
autocorrelation increases the uncertainty of the trend estimate sometimes
by a large amount.</p></dd>


<dt>cols</dt>
<dd><p>Colours to use. Can be a vector of colours e.g. <code>cols =
  c("black", "green")</code> or pre-defined openair colours --- see
<code>openColours</code> for more details.</p></dd>


<dt>shade</dt>
<dd><p>The colour used for marking alternate years. Use “white”
or “transparent” to remove shading.</p></dd>


<dt>xlab</dt>
<dd><p>x-axis label, by default “year”.</p></dd>


<dt>y.relation</dt>
<dd><p>This determines how the y-axis scale is plotted. "same"
ensures all panels use the same scale and "free" will use panel-specific
scales. The latter is a useful setting when plotting data with very
different values.  ref.x See <code>ref.y</code> for details. In this case the
correct date format should be used for a vertical line e.g.  <code>ref.x =
  list(v = as.POSIXct("2000-06-15"), lty = 5)</code>.</p></dd>


<dt>ref.x</dt>
<dd><p>See <code>ref.y</code>.</p></dd>


<dt>ref.y</dt>
<dd><p>A list with details of the horizontal lines to be added
representing reference line(s). For example, <code>ref.y = list(h = 50,
  lty = 5)</code> will add a dashed horizontal line at 50. Several lines can be
plotted e.g. <code>ref.y = list(h = c(50, 100), lty = c(1, 5), col =
  c("green", "blue"))</code>. See <code>panel.abline</code> in the <code>lattice</code>
package for more details on adding/controlling lines.</p></dd>


<dt>key.columns</dt>
<dd><p>Number of columns used if a key is drawn when using the
option <code>statistic = "percentile"</code>.</p></dd>


<dt>name.pol</dt>
<dd><p>Names to be given to the pollutant(s). This is useful if you
want to give a fuller description of the variables, maybe also including
subscripts etc.</p></dd>


<dt>ci</dt>
<dd><p>Should confidence intervals be plotted? The default is
<code>FALSE</code>.</p></dd>


<dt>alpha</dt>
<dd><p>The alpha transparency of shaded confidence intervals - if
plotted. A value of 0 is fully transparent and 1 is fully opaque.</p></dd>


<dt>date.breaks</dt>
<dd><p>Number of major x-axis intervals to use. The function
will try and choose a sensible number of dates/times as well as formatting
the date/time appropriately to the range being considered. This does not
always work as desired automatically. The user can therefore increase or
decrease the number of intervals by adjusting the value of
<code>date.breaks</code> up or down.</p></dd>


<dt>auto.text</dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels will automatically try and format
pollutant names and units properly e.g.  by subscripting the ‘2’ in
NO2.</p></dd>


<dt>k</dt>
<dd><p>This is the smoothing parameter used by the <code>gam</code> function in
package <code>mgcv</code>. By default it is not used and the amount of smoothing
is optimised automatically. However, sometimes it is useful to set the
smoothing amount manually using <code>k</code>.</p></dd>


<dt>plot</dt>
<dd><p>Should a plot be produced? <code>FALSE</code> can be useful when
analysing data to extract plot components and plotting them in other
ways.</p></dd>


<dt>...</dt>
<dd><p>Other graphical parameters are passed onto <code>cutData</code> and
<code>lattice:xyplot</code>. For example, <code>smoothTrend</code> passes the option
<code>hemisphere = "southern"</code> on to <code>cutData</code> to provide southern
(rather than default northern) hemisphere handling of <code>type =
  "season"</code>. Similarly, common graphical arguments, such as <code>xlim</code> and
<code>ylim</code> for plotting ranges and <code>pch</code> and <code>cex</code> for plot
symbol type and size, are passed on <code>xyplot</code>, although some local
modifications may be applied by openair. For example, axis and title
labelling options (such as <code>xlab</code>, <code>ylab</code> and <code>main</code>) are
passed to <code>xyplot</code> via <code>quickText</code> to handle routine formatting.
One special case here is that many graphical parameters can be vectors
when used with <code>statistic = "percentile"</code> and a vector of
<code>percentile</code> values, see examples below.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an <a href="openair-package.html">openair</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>smoothTrend</code> function provides a flexible way of estimating the
trend in the concentration of a pollutant or other variable. Monthly mean
values are calculated from an hourly (or higher resolution) or daily time
series. There is the option to deseasonalise the data if there is evidence
of a seasonal cycle.</p>
<p><code>smoothTrend</code> uses a Generalized Additive Model (GAM) from the
<code>gam</code> package to find the most appropriate level of smoothing.
The function is particularly suited to situations where trends are not
monotonic (see discussion with <code><a href="TheilSen.html">TheilSen()</a></code> for more details on
this). The <code>smoothTrend</code> function is particularly useful as an
exploratory technique e.g. to check how linear or non-linear trends are.</p>
<p>95% confidence intervals are shown by shading. Bootstrap estimates of the
confidence intervals are also available through the <code>simulate</code> option.
Residual resampling is used.</p>
<p>Trends can be considered in a very wide range of ways, controlled by setting
<code>type</code> - see examples below.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other time series and trend functions: 
<code><a href="TheilSen.html">TheilSen</a>()</code>,
<code><a href="calendarPlot.html">calendarPlot</a>()</code>,
<code><a href="runRegression.html">runRegression</a>()</code>,
<code><a href="timePlot.html">timePlot</a>()</code>,
<code><a href="timeProp.html">timeProp</a>()</code>,
<code><a href="timeVariation.html">timeVariation</a>()</code>,
<code><a href="trendLevel.html">trendLevel</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># trend plot for nox</span></span></span>
<span class="r-in"><span><span class="fu">smoothTrend</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"nox"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="smoothTrend-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># trend plot by each of 8 wind sectors</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">smoothTrend</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span>, type <span class="op">=</span> <span class="st">"wd"</span>, ylab <span class="op">=</span> <span class="st">"o3 (ppb)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># several pollutants, no plotting symbol</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">smoothTrend</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no2"</span>, <span class="st">"o3"</span>, <span class="st">"pm10"</span>, <span class="st">"pm25"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># percentiles</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">smoothTrend</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span>, statistic <span class="op">=</span> <span class="st">"percentile"</span>,</span></span>
<span class="r-in"><span>percentile <span class="op">=</span> <span class="fl">95</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># several percentiles with control over lines used</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">smoothTrend</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"o3"</span>, statistic <span class="op">=</span> <span class="st">"percentile"</span>,</span></span>
<span class="r-in"><span>percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">50</span>, <span class="fl">95</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

