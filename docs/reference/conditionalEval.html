<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function enhances conditionalQuantile by also considering
how other variables vary over the same intervals. Conditional quantiles are
very useful on their own for model evaluation, but provide no direct
information on how other variables change at the same time. For example, a
conditional quantile plot of ozone concentrations may show that low
concentrations of ozone tend to be under-predicted. However, the cause of
the under-prediction can be difficult to determine. However, by considering
how well the model predicts other variables over the same intervals, more
insight can be gained into the underlying reasons why model performance is
poor."><title>Conditional quantile estimates with additional variables for model
evaluation — conditionalEval • openair</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conditional quantile estimates with additional variables for model
evaluation — conditionalEval"><meta property="og:description" content="This function enhances conditionalQuantile by also considering
how other variables vary over the same intervals. Conditional quantiles are
very useful on their own for model evaluation, but provide no direct
information on how other variables change at the same time. For example, a
conditional quantile plot of ozone concentrations may show that low
concentrations of ozone tend to be under-predicted. However, the cause of
the under-prediction can be difficult to determine. However, by considering
how well the model predicts other variables over the same intervals, more
insight can be gained into the underlying reasons why model performance is
poor."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.9-0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Conditional quantile estimates with additional variables for model
evaluation</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/HEAD/R/conditionalEval.R" class="external-link"><code>R/conditionalEval.R</code></a></small>
      <div class="d-none name"><code>conditionalEval.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function enhances <code><a href="conditionalQuantile.html">conditionalQuantile</a></code> by also considering
how other variables vary over the same intervals. Conditional quantiles are
very useful on their own for model evaluation, but provide no direct
information on how other variables change at the same time. For example, a
conditional quantile plot of ozone concentrations may show that low
concentrations of ozone tend to be under-predicted. However, the cause of
the under-prediction can be difficult to determine. However, by considering
how well the model predicts other variables over the same intervals, more
insight can be gained into the underlying reasons why model performance is
poor.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">conditionalEval</span><span class="op">(</span>
  <span class="va">mydata</span>,
  obs <span class="op">=</span> <span class="st">"obs"</span>,
  mod <span class="op">=</span> <span class="st">"mod"</span>,
  var.obs <span class="op">=</span> <span class="st">"var.obs"</span>,
  var.mod <span class="op">=</span> <span class="st">"var.mod"</span>,
  type <span class="op">=</span> <span class="st">"default"</span>,
  bins <span class="op">=</span> <span class="fl">31</span>,
  statistic <span class="op">=</span> <span class="st">"MB"</span>,
  xlab <span class="op">=</span> <span class="st">"predicted value"</span>,
  ylab <span class="op">=</span> <span class="st">"statistic"</span>,
  col <span class="op">=</span> <span class="fu">brewer.pal</span><span class="op">(</span><span class="fl">5</span>, <span class="st">"YlOrRd"</span><span class="op">)</span>,
  col.var <span class="op">=</span> <span class="st">"Set1"</span>,
  var.names <span class="op">=</span> <span class="cn">NULL</span>,
  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mydata</dt>
<dd><p>A data frame containing the field <code>obs</code> and <code>mod</code>
representing observed and modelled values.</p></dd>
<dt>obs</dt>
<dd><p>The name of the observations in <code>mydata</code>.</p></dd>
<dt>mod</dt>
<dd><p>The name of the predictions (modelled values) in <code>mydata</code>.</p></dd>
<dt>var.obs</dt>
<dd><p>Other variable observations for which statistics should be
calculated. Can be more than length one e.g. <code>var.obs = c("nox.obs",
"ws.obs")</code>. Note that including other variables could reduce the number of
data available to plot due to teh need of having non-missing data for all
variables.</p></dd>
<dt>var.mod</dt>
<dd><p>Other variable predictions for which statistics should be
calculated. Can be more than length one e.g. <code>var.obs = c("nox.obs",
"ws.obs")</code>.</p></dd>
<dt>type</dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
  and then plotted. The default is will produce a single plot using the
  entire data. Type can be one of the built-in types as detailed in
  <code>cutData</code> e.g. "season", "year", "weekday" and so on. For example,
  <code>type = "season"</code> will produce four plots --- one for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
  frame. If that variable is numeric, then the data will be split into four
  quantiles (if possible) and labelled accordingly. If type is an existing
  character or factor variable, then those categories/levels will be used
  directly. This offers great flexibility for understanding the variation of
  different variables and how they depend on one another.</p></dd>
<dt>bins</dt>
<dd><p>Number of bins used in <code>conditionalQuantile</code>.</p></dd>
<dt>statistic</dt>
<dd><p>Statistic(s) to be plotted. Can be “MB”,
  “NMB”, “r”, “COE”, “MGE”, “NMGE”,
  “RMSE” and “FAC2”, as described in <code>modStats</code>. When
  these statistics are chosen, they are calculated from <code>var.mod</code> and
  <code>var.mod</code>.</p>
<p><code>statistic</code> can also be a value that can be supplied to
  <code>cutData</code>. For example, <code>statistic = "season"</code> will show how
  model performance varies by season across the distribution of predictions
  which might highlight that at high concentrations of NOx the model tends
  to underestimate concentrations and that these periods mostly occur in
  winter. <code>statistic</code> can also be another variable in the data frame
  --- see <code>cutData</code> for more information. A special case is
  <code>statistic = "cluster"</code> if clusters have been calculated using
  <code>trajCluster</code>.</p></dd>
<dt>xlab</dt>
<dd><p>label for the x-axis, by default <code>"predicted value"</code>.</p></dd>
<dt>ylab</dt>
<dd><p>label for the y-axis, by default <code>"observed value"</code>.</p></dd>
<dt>col</dt>
<dd><p>Colours to be used for plotting the uncertainty bands and median
line. Must be of length 5 or more.</p></dd>
<dt>col.var</dt>
<dd><p>Colours for the additional variables to be compared. See
<code>openColours</code> for more details.</p></dd>
<dt>var.names</dt>
<dd><p>Variable names to be shown on plot for plotting
<code>var.obs</code> and <code>var.mod</code>.</p></dd>
<dt>auto.text</dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels etc. will automatically try and format
pollutant names and units properly e.g.  by subscripting the `2' in NO2.</p></dd>
<dt>...</dt>
<dd><p>Other graphical parameters passed onto <code>conditionalQuantile</code>
and <code>cutData</code>. For example, <code>conditionalQuantile</code> passes the
option <code>hemisphere = "southern"</code> on to <code>cutData</code> to provide
southern (rather than default northern) hemisphere handling of <code>type
= "season"</code>. Similarly, common axis and title labelling options (such as
<code>xlab</code>, <code>ylab</code>, <code>main</code>) are passed to <code>xyplot</code> via
<code>quickText</code> to handle routine formatting.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>conditionalEval</code> function provides information on how other
variables vary across the same intervals as shown on the conditional
quantile plot. There are two types of variable that can be considered by
setting the value of <code>statistic</code>. First, <code>statistic</code> can be
another variable in the data frame. In this case the plot will show the
different proportions of <code>statistic</code> across the range of predictions.
For example <code>statistic = "season"</code> will show for each interval of
<code>mod</code> the proportion of predictions that were spring, summer, autumn or
winter. This is useful because if model performance is worse for example at
high concentrations of <code>mod</code> then knowing that these tend to occur
during a particular season etc. can be very helpful when trying to
understand <em>why</em> a model fails. See <code><a href="cutData.html">cutData</a></code> for more
details on the types of variable that can be <code>statistic</code>. Another
example would be <code>statistic = "ws"</code> (if wind speed were available in
the data frame), which would then split wind speed into four quantiles and
plot the proportions of each.</p>
<p>Second, <code>conditionalEval</code> can simultaneously plot the model performance
of other observed/predicted variable <b>pairs</b> according to different
model evaluation statistics. These statistics derive from the
<code><a href="modStats.html">modStats</a></code> function and include “MB”, “NMB”,
“r”, “COE”, “MGE”, “NMGE”, “RMSE” and
“FAC2”. More than one statistic can be supplied e.g. <code>statistic
= c("NMB", "COE")</code>. Bootstrap samples are taken from the corresponding
values of other variables to be plotted and their statistics with 95%
confidence intervals calculated. In this case, the model <em>performance</em>
of other variables is shown across the same intervals of <code>mod</code>, rather
than just the values of single variables. In this second case the model
would need to provide observed/predicted pairs of other variables.</p>
<p>For example, a model may provide predictions of NOx and wind speed (for
which there are also observations available). The <code>conditionalEval</code>
function will show how well these other variables are predicted for the same
intervals of the main variables assessed in the conditional quantile e.g.
ozone. In this case, values are supplied to <code>var.obs</code> (observed values
for other variables) and <code>var.mod</code> (modelled values for other
variables). For example, to consider how well the model predicts NOx and
wind speed <code>var.obs = c("nox.obs", "ws.obs")</code> and <code>var.mod =
c("nox.mod", "ws.mod")</code> would be supplied (assuming <code>nox.obs, nox.mod,
ws.obs, ws.mod</code> are present in the data frame). The analysis could show for
example, when ozone concentrations are under-predicted, the model may also
be shown to over-predict concentrations of NOx at the same time, or
under-predict wind speeds. Such information can thus help identify the
underlying causes of poor model performance. For example, an
under-prediction in wind speed could result in higher surface NOx
concentrations and lower ozone concentrations. Similarly if wind speed
predictions were good and NOx was over predicted it might suggest an
over-estimate of NOx emissions. One or more additional variables can be
plotted.</p>
<p>A special case is <code>statistic = "cluster"</code>. In this case a data frame is
provided that contains the cluster calculated by <code><a href="trajCluster.html">trajCluster</a></code>
and <code><a href="importTraj.html">importTraj</a></code>. Alternatively users could supply their own
pre-calculated clusters. These calculations can be very useful in showing
whether certain back trajectory clusters are associated with poor (or good)
model performance. Note that in the case of <code>statistic = "cluster"</code>
there will be fewer data points used in the analysis compared with the
ordinary statistics above because the trajectories are available for every
three hours. Also note that <code>statistic = "cluster"</code> cannot be used
together with the ordinary model evaluation statistics such as MB. The
output will be a bar chart showing the proportion of each interval of
<code>mod</code> by cluster number.</p>
<p>Far more insight can be gained into model performance through conditioning
using <code>type</code>. For example, <code>type = "season"</code> will plot conditional
quantiles and the associated model performance statistics of other variables
by each season. <code>type</code> can also be a factor or character field e.g.
representing different models used.</p>
<p>See Wilks (2005) for more details of conditional quantile plots.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wilks, D. S., 2005. Statistical Methods in the Atmospheric
  Sciences, Volume 91, Second Edition (International Geophysics), 2nd
  Edition. Academic Press.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See <code><a href="conditionalQuantile.html">conditionalQuantile</a></code> for information on
  conditional quantiles, <code><a href="modStats.html">modStats</a></code> for model evaluation
  statistics and the package <code>verification</code> for comprehensive functions
  for forecast verification.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Examples to follow, or will be shown in the openair manual</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

