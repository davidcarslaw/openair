<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Plots the diurnal, day of the week and monthly variation for different
variables, typically pollutant concentrations. Four separate plots are
produced."><title>Diurnal, day of the week and monthly variation — timeVariation • openair</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diurnal, day of the week and monthly variation — timeVariation"><meta property="og:description" content="Plots the diurnal, day of the week and monthly variation for different
variables, typically pollutant concentrations. Four separate plots are
produced."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.10-0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Diurnal, day of the week and monthly variation</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/openair/blob/HEAD/R/timeVariation.R" class="external-link"><code>R/timeVariation.R</code></a></small>
      <div class="d-none name"><code>timeVariation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plots the diurnal, day of the week and monthly variation for different
variables, typically pollutant concentrations. Four separate plots are
produced.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">timeVariation</span><span class="op">(</span>
  <span class="va">mydata</span>,
  pollutant <span class="op">=</span> <span class="st">"nox"</span>,
  local.tz <span class="op">=</span> <span class="cn">NULL</span>,
  normalise <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hour"</span>, <span class="st">"hour"</span>, <span class="st">"month"</span>, <span class="st">"weekday"</span><span class="op">)</span>,
  name.pol <span class="op">=</span> <span class="va">pollutant</span>,
  type <span class="op">=</span> <span class="st">"default"</span>,
  group <span class="op">=</span> <span class="cn">NULL</span>,
  difference <span class="op">=</span> <span class="cn">FALSE</span>,
  statistic <span class="op">=</span> <span class="st">"mean"</span>,
  conf.int <span class="op">=</span> <span class="fl">0.95</span>,
  B <span class="op">=</span> <span class="fl">100</span>,
  ci <span class="op">=</span> <span class="cn">TRUE</span>,
  cols <span class="op">=</span> <span class="st">"hue"</span>,
  ref.y <span class="op">=</span> <span class="cn">NULL</span>,
  key <span class="op">=</span> <span class="cn">NULL</span>,
  key.columns <span class="op">=</span> <span class="fl">1</span>,
  start.day <span class="op">=</span> <span class="fl">1</span>,
  auto.text <span class="op">=</span> <span class="cn">TRUE</span>,
  alpha <span class="op">=</span> <span class="fl">0.4</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mydata</dt>
<dd><p>A data frame of hourly (or higher temporal resolution data).
Must include a <code>date</code> field and at least one variable to plot.</p></dd>


<dt>pollutant</dt>
<dd><p>Name of variable to plot. Two or more pollutants can be
plotted, in which case a form like <code>pollutant = c("nox", "co")</code>
should be used.</p></dd>


<dt>local.tz</dt>
<dd><p>Should the results be calculated in local time that includes
a treatment of daylight savings time (DST)? The default is not to consider
DST issues, provided the data were imported without a DST offset.
Emissions activity tends to occur at local time e.g. rush hour is at 8 am
every day. When the clocks go forward in spring, the emissions are
effectively released into the atmosphere typically 1 hour earlier during
the summertime i.e. when DST applies. When plotting diurnal profiles, this
has the effect of “smearing-out” the concentrations. Sometimes, a
useful approach is to express time as local time. This correction tends to
produce better-defined diurnal profiles of concentration (or other
variables) and allows a better comparison to be made with
emissions/activity data. If set to <code>FALSE</code> then GMT is used. Examples
of usage include <code>local.tz = "Europe/London"</code>, <code>local.tz =
"America/New_York"</code>. See <code>cutData</code> and <code>import</code> for more
details.</p></dd>


<dt>normalise</dt>
<dd><p>Should variables be normalised? The default is
<code>FALSE</code>. If <code>TRUE</code> then the variable(s) are divided by their
mean values. This helps to compare the shape of the diurnal trends for
variables on very different scales.</p></dd>


<dt>xlab</dt>
<dd><p>x-axis label; one for each sub-plot.</p></dd>


<dt>name.pol</dt>
<dd><p>Names to be given to the pollutant(s). This is useful if you
want to give a fuller description of the variables, maybe also including
subscripts etc.</p></dd>


<dt>type</dt>
<dd><p><code>type</code> determines how the data are split i.e. conditioned,
  and then plotted. The default is will produce a single plot using the
  entire data. Type can be one of the built-in types as detailed in
  <code>cutData</code> e.g. “season”, “year”, “weekday” and
  so on. For example, <code>type = "season"</code> will produce four plots --- one
  for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in the data
  frame. If that variable is numeric, then the data will be split into four
  quantiles (if possible) and labelled accordingly. If type is an existing
  character or factor variable, then those categories/levels will be used
  directly. This offers great flexibility for understanding the variation of
  different variables and how they depend on one another.</p>
<p>Only one <code>type</code> is allowed in<code>timeVariation</code>.</p></dd>


<dt>group</dt>
<dd><p>This sets the grouping variable to be used. For example, if a
data frame had a column <code>site</code> setting <code>group = "site"</code> will
plot all sites together in each panel. See examples below.</p></dd>


<dt>difference</dt>
<dd><p>If two pollutants are chosen then setting <code>difference
= TRUE</code> will also plot the difference in means between the two variables
as <code>pollutant[2] - pollutant[1]</code>. Bootstrap 95% confidence intervals
of the difference in means are also calculated. A horizontal dashed line
is shown at y = 0. The difference can also be calculated if there is a
column that identifies two groups e.g. having used <code>splitByDate</code>. In
this case it is possible to call <code>timeVariation</code> with the option
<code>group = "split.by"</code> and <code>difference = TRUE</code>.</p></dd>


<dt>statistic</dt>
<dd><p>Can be “mean” (default) or “median”. If the
statistic is ‘mean’ then the mean line and the 95% confidence
interval in the mean are plotted by default. If the statistic is
‘median’ then the median line is plotted together with the 5/95 and
25/75th quantiles are plotted. Users can control the confidence intervals
with <code>conf.int</code>.</p></dd>


<dt>conf.int</dt>
<dd><p>The confidence intervals to be plotted. If <code>statistic =
"mean"</code> then the confidence intervals in the mean are plotted. If
<code>statistic = "median"</code> then the <code>conf.int</code> and <code>1 -
conf.int</code> <em>quantiles</em> are plotted. <code>conf.int</code> can be of length
2, which is most useful for showing quantiles. For example <code>conf.int
= c(0.75, 0.99)</code> will yield a plot showing the median, 25/75 and 5/95th
quantiles.</p></dd>


<dt>B</dt>
<dd><p>Number of bootstrap replicates to use. Can be useful to reduce this
value when there are a large number of observations available to increase
the speed of the calculations without affecting the 95% confidence
interval calculations by much.</p></dd>


<dt>ci</dt>
<dd><p>Should confidence intervals be shown? The default is <code>TRUE</code>.
Setting this to <code>FALSE</code> can be useful if multiple pollutants are
chosen where over-lapping confidence intervals can over complicate plots.</p></dd>


<dt>cols</dt>
<dd><p>Colours to be used for plotting. Options include
“default”, “increment”, “heat”, “jet” and
<code>RColorBrewer</code> colours --- see the <code>openair</code> <code>openColours</code>
function for more details. For user defined the user can supply a list of
colour names recognised by R (type <code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colours()</a></code> to see the full list).
An example would be <code>cols = c("yellow", "green", "blue")</code></p></dd>


<dt>ref.y</dt>
<dd><p>A list with details of the horizontal lines to be added
representing reference line(s). For example, <code>ref.y = list(h = 50,
lty = 5)</code> will add a dashed horizontal line at 50. Several lines can be
plotted e.g. <code>ref.y = list(h = c(50, 100), lty = c(1, 5), col =
c("green", "blue"))</code>. See <code>panel.abline</code> in the <code>lattice</code>
package for more details on adding/controlling lines.</p></dd>


<dt>key</dt>
<dd><p>By default <code>timeVariation</code> produces four plots on one page.
While it is useful to see these plots together, it is sometimes necessary
just to use one for a report. If <code>key</code> is <code>TRUE</code>, a key is added
to all plots allowing the extraction of a single plot <em>with</em> key. See
below for an example.</p></dd>


<dt>key.columns</dt>
<dd><p>Number of columns to be used in the key. With many
pollutants a single column can make to key too wide. The user can thus
choose to use several columns by setting <code>columns</code> to be less than
the number of pollutants.</p></dd>


<dt>start.day</dt>
<dd><p>What day of the week should the plots start on? The user
can change the start day by supplying an integer between 0 and 6. Sunday =
0, Monday = 1, ... For example to start the weekday plots on a
Saturday, choose <code>start.day = 6</code>.</p></dd>


<dt>auto.text</dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels will automatically try and format
pollutant names and units properly e.g.  by subscripting the ‘2’ in
NO2.</p></dd>


<dt>alpha</dt>
<dd><p>The alpha transparency used for plotting confidence intervals.
0 is fully transparent and 1 is opaque. The default is 0.4</p></dd>


<dt>...</dt>
<dd><p>Other graphical parameters passed onto <code>lattice:xyplot</code> and
<code>cutData</code>. For example, in the case of <code>cutData</code> the option
<code>hemisphere = "southern"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>As well as generating the plot itself, <code>timeVariation</code> also
  returns an object of class ``openair''. The object includes three main
  components: <code>call</code>, the command used to generate the plot;</p>
<p></p>
<p><code>data</code>, the data used to make the four components of the plot (or
  subplots); and <code>plot</code>, the associated subplots.  If retained, e.g.
  using <code>output &lt;- timeVariation(mydata, "nox")</code>, this output can be
  used to recover the data, reproduce or rework the original plot or
  undertake further analysis.</p>


<p>An openair output can be manipulated using a number of generic operations,
  including <code>print</code>, <code>plot</code> and <code>summary</code>.</p>


<p>The four components of timeVariation are: <code>day.hour</code>, <code>hour</code>,</p>
<p></p>
<p><code>day</code> and <code>month</code>. Associated data.frames can be extracted
  directly using the <code>subset</code> option, e.g. as in <code>plot(object,
  subset = "day.hour")</code>, <code>summary(output, subset = "hour")</code>, etc, for</p>
<p></p>
<p><code>output &lt;- timeVariation(mydata, "nox")</code></p>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The variation of pollutant concentrations by hour of the day and day of the
week etc. can reveal many interesting features that relate to source types
and meteorology. For traffic sources, there are often important differences
in the way vehicles vary by vehicles type e.g. less heavy vehicles at
weekends.</p>
<p>The <code>timeVariation</code> function makes it easy to see how concentrations
(and many other variable types) vary by hour of the day and day of the week.</p>
<p>The plots also show the 95% confidence intervals in the mean. The 95%
confidence intervals in the mean are calculated through bootstrap
simulations, which will provide more robust estimates of the confidence
intervals (particularly when there are relatively few data).</p>
<p>The function can handle multiple pollutants and uses the flexible
<code>type</code> option to provide separate panels for each 'type' --- see
<code>cutData</code> for more details. <code>timeVariation</code> can also accept a
<code>group</code> option which is useful if data are stacked. This will work in a
similar way to having multiple pollutants in separate columns.</p>
<p>The user can supply their own <code>ylim</code> e.g. <code>ylim = c(0, 200)</code> that
will be used for all plots. <code>ylim</code> can also be a list of length four to
control the y-limits on each individual plot e.g. <code>ylim =
list(c(-100,500), c(200, 300), c(-400,400), c(50,70))</code>. These pairs
correspond to the hour, weekday, month and day-hour plots respectively.</p>
<p>The option <code>difference</code> will calculate the difference in means of two
pollutants together with bootstrap estimates of the 95% confidence
intervals in the difference in the mean. This works in two ways: either two
pollutants are supplied in separate columns e.g. <code>pollutant = c("no2",
"o3")</code>, or there are two unique values of <code>group</code>. The difference is
calculated as the second pollutant minus the first and is labelled as such.
Considering differences in this way can provide many useful insights and is
particularly useful for model evaluation when information is needed about
where a model differs from observations by many different time scales. The
manual contains various examples of using <code>difference = TRUE</code>.</p>
<p>Note also that the <code>timeVariation</code> function works well on a subset of
data and in conjunction with other plots. For example, a
<code><a href="polarPlot.html">polarPlot</a></code> may highlight an interesting feature for a
particular wind speed/direction range. By filtering for those conditions
<code>timeVariation</code> can help determine whether the temporal variation of
that feature differs from other features --- and help with source
identification.</p>
<p>In addition, <code>timeVariation</code> will work well with other variables if
available. Examples include meteorological and traffic flow data.</p>
<p>Depending on the choice of statistic, a subheading is added. Users can
control the text in the subheading through the use of <code>sub</code> e.g.
<code>sub = ""</code> will remove any subheading.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="polarPlot.html">polarPlot</a></code>, <code><a href="linearRelation.html">linearRelation</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># basic use</span></span>
<span class="r-in"><span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"nox"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="timeVariation-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># for a subset of conditions</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="fu">timeVariation</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="va">ws</span> <span class="op">&gt;</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">wd</span> <span class="op">&gt;</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">wd</span> <span class="op">&lt;</span> <span class="fl">270</span><span class="op">)</span>,</span>
<span class="r-in">pollutant <span class="op">=</span> <span class="st">"pm10"</span>, ylab <span class="op">=</span> <span class="st">"pm10 (ug/m3)"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># multiple pollutants with concentrations normalised</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nox"</span>, <span class="st">"co"</span><span class="op">)</span>, normalise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># show BST/GMT variation (see ?cutData for more details)</span></span>
<span class="r-in"><span class="co"># the NOx plot shows the profiles are very similar when expressed in</span></span>
<span class="r-in"><span class="co"># local time, showing that the profile is dominated by a local source</span></span>
<span class="r-in"><span class="co"># that varies by local time and not by GMT i.e. road vehicle emissions</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"nox"</span>, type <span class="op">=</span> <span class="st">"dst"</span>, local.tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## In this case it is better to group the results for clarity:</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"nox"</span>, group <span class="op">=</span> <span class="st">"dst"</span>, local.tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># By contrast, a variable such as wind speed shows a clear shift when</span></span>
<span class="r-in"><span class="co">#  expressed in local time. These two plots can help show whether the</span></span>
<span class="r-in"><span class="co">#  variation is dominated by man-made influences or natural processes</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"ws"</span>, group <span class="op">=</span> <span class="st">"dst"</span>, local.tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## It is also possible to plot several variables and set type. For</span></span>
<span class="r-in"><span class="co">## example, consider the NOx and NO2 split by levels of O3:</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nox"</span>, <span class="st">"no2"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"o3"</span>, normalise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## difference in concentrations</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, poll<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pm25"</span>, <span class="st">"pm10"</span><span class="op">)</span>, difference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># It is also useful to consider how concentrations vary by</span></span>
<span class="r-in"><span class="co"># considering two different periods e.g. in intervention</span></span>
<span class="r-in"><span class="co"># analysis. In the following plot NO2 has clearly increased but much</span></span>
<span class="r-in"><span class="co"># less so at weekends - perhaps suggesting vehicles other than cars</span></span>
<span class="r-in"><span class="co"># are important because flows of cars are approximately invariant by</span></span>
<span class="r-in"><span class="co"># day of the week</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="splitByDate.html">splitByDate</a></span><span class="op">(</span><span class="va">mydata</span>, dates<span class="op">=</span> <span class="st">"1/1/2003"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"before Jan. 2003"</span>, <span class="st">"After Jan. 2003"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"no2"</span>, group <span class="op">=</span> <span class="st">"split.by"</span>, difference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## sub plots can be extracted from the openair object</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">myplot</span> <span class="op">&lt;-</span> <span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"no2"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myplot</span>, subset <span class="op">=</span> <span class="st">"day.hour"</span><span class="op">)</span> <span class="co"># top weekday and plot</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## individual plots</span></span>
<span class="r-in"><span class="co">## plot(myplot, subset="day.hour") for the weekday and hours subplot (top)</span></span>
<span class="r-in"><span class="co">## plot(myplot, subset="hour") for the diurnal plot</span></span>
<span class="r-in"><span class="co">## plot(myplot, subset="day") for the weekday plot</span></span>
<span class="r-in"><span class="co">## plot(myplot, subset="month") for the monthly plot</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## numerical results (mean, lower/upper uncertainties)</span></span>
<span class="r-in"><span class="co">## results(myplot, subset = "day.hour") # the weekday and hour data set</span></span>
<span class="r-in"><span class="co">## summary(myplot, subset = "hour") #summary of hour data set</span></span>
<span class="r-in"><span class="co">## head(myplot, subset = "day") #head/top of day data set</span></span>
<span class="r-in"><span class="co">## tail(myplot, subset = "month") #tail/top of month data set</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## plot quantiles and median</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, stati<span class="op">=</span><span class="st">"median"</span>, poll<span class="op">=</span><span class="st">"pm10"</span>, col <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## with different intervals</span></span>
<span class="r-in"><span class="fu">timeVariation</span><span class="op">(</span><span class="va">mydata</span>, stati<span class="op">=</span><span class="st">"median"</span>, poll<span class="op">=</span><span class="st">"pm10"</span>, conf.int <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.99</span><span class="op">)</span>,</span>
<span class="r-in">col <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

    </footer></div>

  

  

  </body></html>

